<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Norbin</title>
<style>
:root {
    --bg-color: #000000;
    --text-color: #ffffff;
    --accent-color: #ffffff;
    --border-color: #333333;
    --hover-color: #222222;
    --table-header: #111111;
    --table-row: #0a0a0a;
    --table-alt: #111111;
    --owner-color: #ff0000;
    --manager-color: #ff9900;
    --vip-color: #ffd700;
    --tagmaker-color: #00ff00;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    transition: all 0.3s ease;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #000000;
    border: 1px solid var(--accent-color);
}

::-webkit-scrollbar-thumb {
    background: var(--accent-color);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #cccccc;
}

.navbar {
    background-color: #000000;
    padding: 1rem 2rem;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    border-bottom: 1px solid var(--accent-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.hamburger-btn {
    background: none;
    border: none;
    color: var(--accent-color);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0.5rem;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.role-badge {
    padding: 0.1rem 0.5rem;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: bold;
    margin-left: 0.3rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.owner-badge {
    background: linear-gradient(45deg, var(--owner-color), #ff4444);
    color: white;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
    animation: bloodPulse 2s infinite;
}

.manager-badge {
    background: linear-gradient(45deg, var(--manager-color), #ffbb33);
    color: black;
}

.vip-badge {
    background: linear-gradient(45deg, var(--vip-color), #ffff44);
    color: black;
    animation: goldGlow 2s infinite;
}

.tagmaker-badge {
    background: linear-gradient(45deg, var(--tagmaker-color), #44ff44);
    color: black;
}

@keyframes bloodPulse {
    0%, 100% { box-shadow: 0 0 5px var(--owner-color), 0 0 10px var(--owner-color); }
    50% { box-shadow: 0 0 15px var(--owner-color), 0 0 30px var(--owner-color); }
}

@keyframes goldGlow {
    0%, 100% { box-shadow: 0 0 5px var(--vip-color); }
    50% { box-shadow: 0 0 15px var(--vip-color); }
}

.slide-down-menu {
    position: fixed;
    top: -100%;
    left: 0;
    width: 100%;
    background-color: #000000;
    z-index: 999;
    padding: 0;
    border-bottom: 1px solid var(--accent-color);
    transition: top 0.3s ease;
}

.slide-down-menu.active {
    top: 60px;
}

.menu-items {
    display: flex;
    flex-direction: column;
    width: 100%;
}

.menu-btn {
    background: transparent;
    color: var(--accent-color);
    border: none;
    border-bottom: 1px solid var(--border-color);
    padding: 1rem 2rem;
    text-align: left;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
}

.menu-btn:last-child {
    border-bottom: none;
}

.menu-btn:hover {
    background: var(--hover-color);
    color: var(--accent-color);
}

.menu-btn:active {
    background: #333333;
}

.hidden {
    display: none !important;
}

.main-content {
    padding-top: 80px;
    max-width: 1400px;
    margin: 0 auto;
    padding: 80px 1rem 2rem;
    min-height: calc(100vh - 80px);
}

.logo-container {
    text-align: center;
    margin-bottom: 2rem;
}

.logo {
    max-width: 300px;
    height: auto;
    margin: 1rem auto;
    border: 1px solid var(--accent-color);
    padding: 1rem;
    background: #000000;
}

.search-container {
    max-width: 800px;
    margin: 0 auto 2rem;
}

.search-bar {
    width: 100%;
    padding: 0.8rem 1.2rem;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    background: #000000;
    color: var(--accent-color);
    font-size: 1rem;
    outline: none;
}

.search-bar::placeholder {
    color: #666;
}

.search-results {
    margin-top: 1rem;
    background: #111111;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    padding: 1rem;
}

.pastes-section {
    margin-top: 2rem;
}

.section-title {
    color: var(--accent-color);
    font-size: 1.2rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-color);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.paste-table-container {
    overflow-x: auto;
    margin-bottom: 2rem;
    border: 1px solid var(--border-color);
    border-radius: 3px;
}

.paste-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

.paste-table th {
    background-color: var(--table-header);
    color: var(--accent-color);
    font-weight: bold;
    text-align: left;
    padding: 0.8rem 1rem;
    border-bottom: 2px solid var(--accent-color);
    text-transform: uppercase;
    font-size: 0.9rem;
    letter-spacing: 0.5px;
}

.paste-table td {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid var(--border-color);
    background-color: var(--table-row);
}

.paste-table tr:nth-child(even) td {
    background-color: var(--table-alt);
}

.paste-table tr:hover td {
    background-color: var(--hover-color);
    cursor: pointer;
}

.paste-table tr:hover .paste-title {
    color: var(--accent-color);
}

.paste-title {
    color: var(--accent-color);
    font-weight: bold;
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.paste-comments,
.paste-views {
    text-align: center;
    font-family: monospace;
    color: #888;
}

.paste-author {
    color: #ccc;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.paste-date {
    color: #666;
    font-size: 0.9rem;
    text-align: right;
}

.paste-table tr.pinned-row td {
    background-color: #111111;
    border-left: 3px solid var(--accent-color);
}

.paste-table tr.pinned-row:hover td {
    background-color: #1a1a1a;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 2rem;
    padding: 1rem;
    border-top: 1px solid var(--border-color);
}

.page-btn {
    background: transparent;
    color: var(--accent-color);
    border: 1px solid var(--border-color);
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 3px;
    font-size: 0.9rem;
    min-width: 40px;
}

.page-btn:hover:not(:disabled) {
    background: var(--hover-color);
    border-color: var(--accent-color);
}

.page-btn.active {
    background: var(--accent-color);
    color: #000000;
    border-color: var(--accent-color);
}

.page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-info {
    color: #888;
    font-size: 0.9rem;
    margin: 0 1rem;
}

.paste-detail-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #000000;
    z-index: 9999;
    padding: 20px;
    overflow-y: auto;
    display: none;
}

.paste-detail-container.active {
    display: block;
}

.paste-detail-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(0, 0, 0, 0.9);
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--accent-color);
    z-index: 10000;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.paste-detail-content {
    margin-top: 60px;
    padding: 2rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.back-btn {
    background: transparent;
    color: var(--accent-color);
    border: 1px solid var(--accent-color);
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 3px;
    font-size: 0.9rem;
    transition: all 0.3s;
}

.back-btn:hover {
    background: var(--accent-color);
    color: #000000;
}

.paste-content {
    white-space: pre-wrap;
    font-family: 'Courier New', monospace;
    background: #000000;
    padding: 2rem;
    border-radius: 3px;
    border: 1px solid var(--accent-color);
    margin-top: 2rem;
    min-height: 200px;
    max-height: calc(100vh - 200px);
    overflow-y: auto;
    line-height: 1.6;
    font-size: 1rem;
}

.paste-form, .auth-form, .profile-form, .timeout-form, .tag-form {
    max-width: 800px;
    margin: 0 auto;
    background: #111111;
    padding: 2rem;
    border-radius: 3px;
    border: 1px solid var(--accent-color);
}

.form-group {
    margin-bottom: 1rem;
}

.form-label {
    display: block;
    margin-bottom: 0.3rem;
    font-weight: bold;
    color: var(--accent-color);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    background: #000000;
    color: var(--accent-color);
    font-size: 0.9rem;
    outline: none;
}

.form-textarea {
    min-height: 300px;
    font-family: 'Courier New', monospace;
    resize: vertical;
}

.url-input-group {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.url-input {
    flex: 1;
    padding: 0.6rem;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    background: #000000;
    color: var(--accent-color);
}

.timeout-inputs {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.btn {
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 3px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.btn-primary {
    background: transparent;
    color: var(--accent-color);
    border: 1px solid var(--accent-color);
}

.btn-primary:hover {
    background: var(--accent-color);
    color: #000000;
}

.btn-secondary {
    background: transparent;
    color: var(--accent-color);
    border: 1px solid #666666;
}

.btn-secondary:hover {
    background: #333333;
    border-color: var(--accent-color);
}

.btn-danger {
    background: transparent;
    color: #ff0000;
    border: 1px solid #ff0000;
}

.btn-danger:hover {
    background: #ff0000;
    color: white;
}

.btn-success {
    background: transparent;
    color: #00aa00;
    border: 1px solid #00aa00;
}

.btn-success:hover {
    background: #00aa00;
    color: white;
}

.btn-warning {
    background: transparent;
    color: var(--manager-color);
    border: 1px solid var(--manager-color);
}

.btn-warning:hover {
    background: var(--manager-color);
    color: black;
}

.btn-group {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.chat-container {
    max-width: 1000px;
    margin: 0 auto;
    background: #111111;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    height: 600px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.chat-header {
    background: #000000;
    padding: 0.8rem;
    border-bottom: 1px solid var(--accent-color);
    text-align: center;
    font-size: 0.9rem;
    color: var(--accent-color);
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
    background: #0a0a0a;
}

.message {
    margin-bottom: 0.8rem;
    padding: 0.8rem;
    background: #111111;
    border-radius: 3px;
    border-left: 2px solid var(--accent-color);
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.3rem;
}

.message-sender {
    font-weight: bold;
    color: var(--accent-color);
    font-size: 0.9rem;
}

.message-time {
    color: #888888;
    font-size: 0.8rem;
}

.chat-input-container {
    padding: 0.8rem;
    background: #000000;
    border-top: 1px solid var(--accent-color);
}

.chat-input-wrapper {
    display: flex;
    gap: 0.5rem;
}

.chat-input {
    flex: 1;
    padding: 0.6rem;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    background: #000000;
    color: var(--accent-color);
    font-size: 0.9rem;
    outline: none;
}

.send-btn {
    padding: 0.6rem 1rem;
    background: transparent;
    color: var(--accent-color);
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
}

.send-btn:hover {
    background: var(--accent-color);
    color: #000000;
}

.hall-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-top: 1rem;
}

@media (max-width: 1200px) {
    .hall-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .hall-grid {
        grid-template-columns: 1fr;
    }
}

.hall-box {
    background: #111111;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s;
}

.hall-box:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
}

.hall-image {
    width: 100%;
    height: 150px;
    background: #000000;
    border: 1px solid var(--accent-color);
    margin-bottom: 0.8rem;
    border-radius: 3px;
    overflow: hidden;
}

.hall-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.hall-name {
    font-size: 1rem;
    font-weight: bold;
    margin-bottom: 0.3rem;
    color: var(--accent-color);
}

.hall-description {
    color: #888888;
    font-size: 0.8rem;
}

.profile-banner {
    height: 200px;
    background: #000000;
    border-radius: 3px;
    margin-bottom: 1rem;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--accent-color);
}

.profile-banner-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-picture {
    width: 100px;
    height: 100px;
    background: #000000;
    position: absolute;
    bottom: -50px;
    left: 2rem;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    overflow: hidden;
}

.profile-picture-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.admin-controls {
    background: #111111;
    border: 1px solid #ff0000;
    border-radius: 3px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.admin-title {
    color: #ff0000;
    font-size: 1.2rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid #ff0000;
    padding-bottom: 0.3rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

.stat-box {
    background: #000000;
    border: 1px solid var(--accent-color);
    border-radius: 3px;
    padding: 0.8rem;
    text-align: center;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--accent-color);
}

.stat-label {
    color: #888;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.admin-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

.timeout-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    z-index: 99999;
    display: none;
    justify-content: center;
    align-items: center;
}

.timeout-overlay.active {
    display: flex;
}

.timeout-message {
    background: #111111;
    border: 2px solid #ff0000;
    border-radius: 3px;
    padding: 2rem;
    text-align: center;
    max-width: 500px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
    50% { border-color: #ff4444; box-shadow: 0 0 20px #ff0000; }
}

.timeout-title {
    color: #ff0000;
    font-size: 2rem;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.timeout-details {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
    color: #ffffff;
}

.timeout-reason {
    font-size: 1rem;
    color: #cccccc;
    margin-top: 1rem;
}

.tags-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.8rem;
    margin-top: 0.8rem;
}

.tag-card {
    background: #111111;
    border: 1px solid var(--tagmaker-color);
    border-radius: 3px;
    padding: 0.8rem;
}

.tag-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.8rem;
}

.tag-name {
    color: var(--tagmaker-color);
    font-size: 1rem;
    font-weight: bold;
}

.tag-users {
    margin-top: 0.3rem;
}

.tag-user {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.3rem;
    background: #000000;
    border-radius: 3px;
    margin-bottom: 0.3rem;
    font-size: 0.8rem;
}

.color-picker {
    display: flex;
    gap: 0.3rem;
    margin-top: 0.3rem;
    flex-wrap: wrap;
}

.color-option {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    cursor: pointer;
    border: 1px solid transparent;
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.selected {
    border: 1px solid white;
}

.alert-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
}

.alert {
    padding: 0.8rem 1.5rem;
    margin-bottom: 0.5rem;
    border-radius: 3px;
    background: #111111;
    color: var(--accent-color);
    border: 1px solid var(--accent-color);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    animation: slideIn 0.3s ease-out;
    font-size: 0.9rem;
}

.alert.error {
    border-color: #ff0000;
    color: #ff0000;
}

.alert.success {
    border-color: #00aa00;
    color: #00aa00;
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.text-center { text-align: center; }
.mt-2 { margin-top: 0.5rem; }
.mt-3 { margin-top: 0.8rem; }
.mt-4 { margin-top: 1rem; }
.mt-5 { margin-top: 1.5rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 0.8rem; }
.mb-4 { margin-bottom: 1rem; }
.mb-5 { margin-bottom: 1.5rem; }
.d-flex { display: flex; }
.justify-between { justify-content: space-between; }
.align-center { align-items: center; }
.gap-2 { gap: 0.5rem; }
.gap-3 { gap: 0.8rem; }

@media (max-width: 768px) {
    .main-content { padding: 70px 0.5rem 1rem; }
    .paste-form, .auth-form, .timeout-form, .tag-form { padding: 1rem; }
    .btn-group { flex-direction: column; }
    .paste-detail-content { padding: 1rem; }
    .paste-content { padding: 1rem; }
    .timeout-inputs { grid-template-columns: 1fr; }
    .paste-table th, .paste-table td { padding: 0.6rem 0.8rem; }
    .pagination { flex-wrap: wrap; }
    .logo { max-width: 200px; }
}
</style>
</head>
<body>
<div id="paste-detail-container" class="paste-detail-container">
    <div class="paste-detail-header">
        <button class="back-btn" onclick="closePasteDetail()">Back</button>
        <div id="paste-detail-actions"></div>
    </div>
    <div id="paste-detail-content" class="paste-detail-content"></div>
</div>

<div id="timeout-overlay" class="timeout-overlay">
    <div class="timeout-message">
        <h1 class="timeout-title">TIMED OUT</h1>
        <div class="timeout-details" id="timeout-details">You have been timed out</div>
        <div class="timeout-reason" id="timeout-reason"></div>
        <div class="timeout-timer" id="timeout-timer" style="font-size: 1.5rem; margin-top: 1rem;"></div>
    </div>
</div>

<nav class="navbar">
    <button class="hamburger-btn" onclick="toggleMenu()">☰</button>
    <div class="user-info">
        <span id="usernameDisplay"></span>
        <button class="btn btn-primary" onclick="showPage('auth')" id="authBtn">Sign In</button>
    </div>
</nav>

<div class="slide-down-menu" id="slideDownMenu">
    <div class="menu-items">
        <button class="menu-btn" onclick="showPage('home')">Home</button>
        <button class="menu-btn" onclick="showPage('paste')">Create Paste</button>
        <button class="menu-btn" onclick="showPage('chat')">Global Chat</button>
        <button class="menu-btn" onclick="showPage('most-mentioned')">Most Mentioned</button>
        <button class="menu-btn" onclick="showPage('hall')">Hall of Autism</button>
        <button class="menu-btn hidden" id="myAccountBtn" onclick="showPage('myaccount')">My Account</button>
        <button class="menu-btn hidden" id="tagMakerBtn" onclick="showPage('tagmaker')">Tag Management</button>
        <button class="menu-btn hidden" id="adminBtn" onclick="showPage('admin')">Admin Panel</button>
        <button class="menu-btn hidden" id="managerBtn" onclick="showPage('manager')">Manager Panel</button>
    </div>
</div>

<div class="main-content">
    <div id="home-page">
        <div class="logo-container">
            <img src="https://i.postimg.cc/x8ML5hVd/logo.jpg" alt="Norbin Logo" class="logo" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x100/000000/ffffff?text=NORBIN+LOGO';">
        </div>

        <div class="search-container">
            <input type="text" class="search-bar" id="searchBar" placeholder="Search pastes by title, username, or content..." oninput="handleSearch()">
            <div class="search-results hidden" id="searchResults">
                <div class="paste-table-container">
                    <table class="paste-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th style="width: 100px;">Views</th>
                                <th style="width: 150px;">Created by</th>
                                <th style="width: 120px;">Added</th>
                            </tr>
                        </thead>
                        <tbody id="searchResultsContent"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="pinned-pastes-section" class="pastes-section">
            <h2 class="section-title">Pinned Pastes</h2>
            <div class="paste-table-container">
                <table class="paste-table" id="pinned-pastes-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th style="width: 100px;">Comments</th>
                            <th style="width: 100px;">Views</th>
                            <th style="width: 150px;">Created by</th>
                            <th style="width: 120px;">Added</th>
                        </tr>
                    </thead>
                    <tbody id="pinned-pastes-body"></tbody>
                </table>
            </div>
        </div>

        <div id="all-pastes-section" class="pastes-section">
            <h2 class="section-title">All Pastes</h2>
            <div class="paste-table-container">
                <table class="paste-table" id="all-pastes-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th style="width: 100px;">Comments</th>
                            <th style="width: 100px;">Views</th>
                            <th style="width: 150px;">Created by</th>
                            <th style="width: 120px;">Added</th>
                        </tr>
                    </thead>
                    <tbody id="all-pastes-body"></tbody>
                </table>
            </div>
        </div>

        <div class="pagination" id="pagination">
            <button class="page-btn" onclick="changePage(-1)" id="prev-btn">Previous</button>
            <span class="page-info" id="page-info">Page 1 of 1</span>
            <button class="page-btn" onclick="changePage(1)" id="next-btn">Next</button>
        </div>
    </div>

    <div id="paste-page" class="hidden">
        <h2 class="section-title">Create New Paste</h2>
        <div class="paste-form">
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-input" id="paste-title" placeholder="Enter paste title">
            </div>
            <div class="form-group">
                <label class="form-label">Content</label>
                <textarea class="form-textarea" id="paste-content" placeholder="Enter your paste content here..."></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="publishPaste()">Publish</button>
                <button class="btn btn-secondary" onclick="clearPasteForm()">Clear</button>
            </div>
        </div>
    </div>

    <div id="chat-page" class="hidden">
        <h2 class="section-title">Global Chat</h2>
        <div class="chat-container">
            <div class="chat-header">Live Global Chat • <span id="onlineCount">0</span> users online</div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text" class="chat-input" id="chat-input" placeholder="Type your message... (Press Enter to send)" onkeypress="if(event.key === 'Enter') sendChatMessage()">
                    <button class="send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="most-mentioned-page" class="hidden">
        <h2 class="section-title">Most Mentioned Titles</h2>
        <div id="most-mentioned-container" class="paste-table-container">
            <table class="paste-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th style="width: 150px;">Mentions</th>
                        <th style="width: 120px;">Last Mentioned</th>
                    </tr>
                </thead>
                <tbody id="most-mentioned-body"></tbody>
            </table>
        </div>
    </div>

    <div id="hall-page" class="hidden">
        <h2 class="section-title">Hall of Autism</h2>
        <div class="hall-grid" id="hall-container"></div>
    </div>

    <div id="myaccount-page" class="hidden">
        <h2 class="section-title">My Account</h2>
        <div class="profile-form">
            <div class="form-group">
                <div class="profile-banner">
                    <div id="profile-banner-img" class="profile-banner-img"></div>
                    <div class="profile-picture">
                        <div id="profile-picture-img" class="profile-picture-img"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-input" id="display-name" placeholder="Enter display name">
                    <button class="btn btn-primary mt-3" onclick="updateDisplayName()">Update Display Name</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Username Color</label>
                    <div class="color-picker" id="color-picker">
                        <div class="color-option" style="background: #ffffff;" onclick="selectColor('#ffffff')"></div>
                        <div class="color-option" style="background: #ff0000;" onclick="selectColor('#ff0000')"></div>
                        <div class="color-option" style="background: #00ff00;" onclick="selectColor('#00ff00')"></div>
                        <div class="color-option" style="background: #0000ff;" onclick="selectColor('#0000ff')"></div>
                        <div class="color-option" style="background: #ffff00;" onclick="selectColor('#ffff00')"></div>
                        <div class="color-option" style="background: #ff00ff;" onclick="selectColor('#ff00ff')"></div>
                        <div class="color-option" style="background: #00ffff;" onclick="selectColor('#00ffff')"></div>
                        <div class="color-option" style="background: #ff9900;" onclick="selectColor('#ff9900')"></div>
                    </div>
                    <button class="btn btn-primary mt-3" onclick="updateUsernameColor()" id="updateColorBtn">Update Color</button>
                </div>
                <div class="form-group">
                    <label class="form-label">Banner Image URL</label>
                    <div class="url-input-group">
                        <input type="text" class="url-input" id="banner-url" placeholder="https://example.com/banner.jpg">
                        <button class="btn btn-primary" onclick="updateBanner()">Update</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Profile Picture URL</label>
                    <div class="url-input-group">
                        <input type="text" class="url-input" id="profile-url" placeholder="https://example.com/profile.jpg">
                        <button class="btn btn-primary" onclick="updateProfilePicture()">Update</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-page" class="hidden">
        <h2 class="section-title">Admin Panel</h2>
        <div class="admin-controls">
            <div class="admin-title">Administrator Controls</div>
            <div class="admin-stats">
                <div class="stat-box">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="totalPastes">0</div>
                    <div class="stat-label">Total Pastes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="bannedUsers">0</div>
                    <div class="stat-label">Banned Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="pinnedPastes">0</div>
                    <div class="stat-label">Pinned Pastes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="timedOutUsers">0</div>
                    <div class="stat-label">Timed Out Users</div>
                </div>
            </div>
            <div class="admin-actions">
                <button class="btn btn-danger" onclick="adminViewAllUsers()">View All Users</button>
                <button class="btn btn-danger" onclick="adminViewAllPastes()">View All Pastes</button>
                <button class="btn btn-danger" onclick="adminClearChat()">Clear Chat</button>
                <button class="btn btn-danger" onclick="adminBackupData()">Backup Data</button>
                <button class="btn btn-warning" onclick="adminManageRoles()">Manage Roles</button>
                <button class="btn btn-warning" onclick="showPage('timeout')">Timeout Users</button>
                <button class="btn btn-warning" onclick="showPage('tagmaker')">Manage Tags</button>
            </div>
            <div id="admin-content" class="mt-4"></div>
        </div>
    </div>

    <div id="manager-page" class="hidden">
        <h2 class="section-title">Manager Panel</h2>
        <div class="admin-controls" style="border-color: var(--manager-color);">
            <div class="admin-title" style="color: var(--manager-color);">Manager Controls</div>
            <div class="admin-actions">
                <button class="btn btn-warning" onclick="managerViewUsers()">View Users</button>
                <button class="btn btn-warning" onclick="managerViewPastes()">View Pastes</button>
                <button class="btn btn-warning" onclick="showPage('timeout')">Timeout Users</button>
                <button class="btn btn-danger" onclick="managerClearChat()">Clear Chat</button>
                <button class="btn btn-danger" onclick="managerViewAllPastes()">Remove Pastes</button>
            </div>
            <div id="manager-content" class="mt-4"></div>
        </div>
    </div>

    <div id="timeout-page" class="hidden">
        <h2 class="section-title">Timeout Users</h2>
        <div class="timeout-form">
            <div class="form-group">
                <label class="form-label">Select User</label>
                <select class="form-select" id="timeout-user-select">
                    <option value="">-- Select a user --</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Timeout Duration</label>
                <div class="timeout-inputs">
                    <input type="number" class="form-input" id="timeout-days" placeholder="Days" min="0">
                    <input type="number" class="form-input" id="timeout-hours" placeholder="Hours" min="0" max="23">
                    <input type="number" class="form-input" id="timeout-minutes" placeholder="Minutes" min="0" max="59">
                    <input type="number" class="form-input" id="timeout-seconds" placeholder="Seconds" min="0" max="59">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Reason</label>
                <input type="text" class="form-input" id="timeout-reason-input" placeholder="Reason for timeout">
            </div>
            <div class="btn-group">
                <button class="btn btn-danger" onclick="timeoutUser()">Timeout User</button>
                <button class="btn btn-success" onclick="untimeoutUser()">Remove Timeout</button>
                <button class="btn btn-secondary" onclick="showPage('admin')">Back</button>
            </div>
            <div id="timeout-content" class="mt-4">
                <h3>Currently Timed Out Users</h3>
                <div id="timed-out-list" class="paste-table-container">
                    <table class="paste-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Time Remaining</th>
                                <th>Reason</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="timed-out-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="tagmaker-page" class="hidden">
        <h2 class="section-title">Tag Management</h2>
        <div class="tag-form">
            <div class="form-group">
                <label class="form-label">Create New Tag</label>
                <input type="text" class="form-input" id="new-tag-name" placeholder="Enter tag name">
                <button class="btn btn-primary mt-3" onclick="createTag()">Create Tag</button>
            </div>
            <div id="tags-container" class="mt-4">
                <h3>Existing Tags</h3>
                <div id="tags-list" class="tags-grid"></div>
            </div>
        </div>
    </div>

    <div id="user-profile-page" class="hidden">
        <button class="back-btn" onclick="showPage('home')">Back</button>
        <div id="user-profile-content" class="paste-detail"></div>
    </div>

    <div id="auth-page" class="hidden">
        <h2 class="section-title">Authentication</h2>
        <div class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="auth-email" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="auth-password" placeholder="••••••••">
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="signIn()">Sign In</button>
                <button class="btn btn-secondary" onclick="signUp()">Create Account</button>
            </div>
            <div id="auth-message" class="mt-3 text-center"></div>
        </div>
    </div>
</div>

<div id="alert-container" class="alert-container"></div>

<audio id="hallMusic" autoplay loop style="display: none;">
    <source src="https://jumpshare.com/share/TQW46hI41f8SrHjqZkva" type="audio/mpeg">
</audio>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
const pasteDbConfig = {
    apiKey: "AIzaSyA1qaJnsRvWDvxNn9Nd1tmMVjvkF-WpUQY",
    authDomain: "norbin-c2fdb.firebaseapp.com",
    projectId: "norbin-c2fdb",
    storageBucket: "norbin-c2fdb.firebasestorage.app",
    messagingSenderId: "38678324468",
    appId: "1:38678324468:web:99301da909b4a563312aa1",
    measurementId: "G-XCBZJYZ2MJ"
};

const chatDbConfig = {
    apiKey: "AIzaSyByN2D1Q9IasxBI9qNostCzg13WbIFipUc",
    authDomain: "norbin-chat.firebaseapp.com",
    projectId: "norbin-chat",
    storageBucket: "norbin-chat.firebasestorage.app",
    messagingSenderId: "793931248044",
    appId: "1:793931248044:web:80a954c39e17efafd58a09",
    measurementId: "G-3TQ13WL0NV"
};

const pasteApp = firebase.initializeApp(pasteDbConfig, "pasteApp");
const chatApp = firebase.initializeApp(chatDbConfig, "chatApp");

const pasteAuth = pasteApp.auth();
const pasteDb = pasteApp.firestore();
const chatDb = chatApp.firestore();

let currentUser = null;
let isAdmin = false;
let isManager = false;
let isVip = false;
let isTagMaker = false;
let selectedColor = '#ffffff';
let searchTimeout = null;

let currentPage = 1;
const pastesPerPage = 20;
let totalPastes = 0;
let totalPages = 1;
let lastVisibleDoc = null;
let firstVisibleDoc = null;

function showAlert(message, type = 'info') {
    const container = document.getElementById('alert-container');
    const alert = document.createElement('div');
    alert.className = `alert ${type}`;
    alert.textContent = message;
    container.appendChild(alert);
    setTimeout(() => alert.remove(), 5000);
}

function toggleMenu() {
    const menu = document.getElementById('slideDownMenu');
    menu.classList.toggle('active');
}

function showPage(pageId) {
    document.getElementById('slideDownMenu').classList.remove('active');
    document.querySelectorAll('[id$="-page"]').forEach(page => page.classList.add('hidden'));
    const page = document.getElementById(pageId + '-page');
    if (page) {
        page.classList.remove('hidden');
        switch(pageId) {
            case 'home':
                loadPinnedPastes();
                loadAllPastes();
                break;
            case 'chat':
                loadChatMessages();
                break;
            case 'most-mentioned':
                loadMostMentioned();
                break;
            case 'hall':
                initializeHallOfAutism();
                break;
            case 'myaccount':
                loadUserProfileData();
                break;
            case 'admin':
                loadAdminStats();
                break;
            case 'manager':
                loadManagerStats();
                break;
            case 'timeout':
                loadTimeoutUsers();
                break;
            case 'tagmaker':
                loadTags();
                break;
        }
    }
}

function showPasteDetail(pasteId) {
    document.getElementById('paste-detail-container').classList.add('active');
    document.body.style.overflow = 'hidden';
    loadPasteDetailContent(pasteId);
}

function closePasteDetail() {
    document.getElementById('paste-detail-container').classList.remove('active');
    document.body.style.overflow = 'auto';
}

async function loadPasteDetailContent(pasteId) {
    try {
        await pasteDb.collection('pastes').doc(pasteId).update({
            views: firebase.firestore.FieldValue.increment(1)
        });
        const doc = await pasteDb.collection('pastes').doc(pasteId).get();
        const paste = doc.data();
        const container = document.getElementById('paste-detail-content');
        const actionsContainer = document.getElementById('paste-detail-actions');
        let adminControls = '';
        if (isAdmin || isManager) {
            adminControls = `<div class="btn-group">
                <button class="btn btn-success" onclick="adminPinPaste('${pasteId}', ${!paste.isPinned})">
                    ${paste.isPinned ? 'Unpin Paste' : 'Pin Paste'}
                </button>
                <button class="btn btn-danger" onclick="adminRemovePaste('${pasteId}')">Remove Paste</button>
                <button class="btn btn-danger" onclick="adminBanUser('${paste.userId}')">Ban User</button>
            </div>`;
        }
        actionsContainer.innerHTML = adminControls;
        container.innerHTML = `
            <div class="paste-username" onclick="showUserProfile('${paste.userId}')">
                ${escapeHtml(paste.username || 'Unknown User')}
                ${paste.isPinned ? '<span class="pinned-badge">PINNED BY ADMIN</span>' : ''}
            </div>
            <h2 style="color: var(--accent-color); margin-bottom: 1rem; font-size: 2rem;">
                ${escapeHtml(paste.title)}
            </h2>
            <div class="paste-views" style="margin-bottom: 2rem;">
                ${paste.views || 0} views • ${formatTime(paste.timestamp?.toDate())}
            </div>
            <div class="paste-content">${escapeHtml(paste.content)}</div>
        `;
    } catch (error) {
        showAlert(`Error loading paste: ${error.message}`, 'error');
        closePasteDetail();
    }
}

async function adminPinPaste(pasteId, pinState) {
    if (!isAdmin && !isManager) return;
    try {
        await pasteDb.collection('pastes').doc(pasteId).update({ isPinned: pinState });
        showAlert(`Paste ${pinState ? 'pinned' : 'unpinned'}`, 'success');
        loadPinnedPastes();
        loadAllPastes();
        loadPasteDetailContent(pasteId);
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminRemovePaste(pasteId) {
    if (!isAdmin && !isManager) return;
    if (confirm('Are you sure you want to remove this paste?')) {
        try {
            await pasteDb.collection('pastes').doc(pasteId).update({ isRemoved: true });
            showAlert('Paste removed', 'success');
            closePasteDetail();
            loadAllPastes();
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function loadPinnedPastes() {
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('isPinned', '==', true)
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .limit(10)
            .get();
        displayPastesTable(snapshot, 'pinned-pastes-body', true);
    } catch (error) {
        document.getElementById('pinned-pastes-body').innerHTML = 
            '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No pinned pastes</td></tr>';
    }
}

async function loadAllPastes() {
    try {
        let query = pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .limit(pastesPerPage);
        const snapshot = await query.get();
        totalPastes = snapshot.size;
        totalPages = Math.max(1, Math.ceil(totalPastes / pastesPerPage));
        if (snapshot.docs.length > 0) {
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];
            firstVisibleDoc = snapshot.docs[0];
        }
        displayPastesTable(snapshot, 'all-pastes-body', false);
        updatePagination();
    } catch (error) {
        document.getElementById('all-pastes-body').innerHTML = 
            '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No pastes yet. Be the first to create one!</td></tr>';
    }
}

async function changePage(delta) {
    if (delta === 1 && !lastVisibleDoc) return;
    if (delta === -1 && !firstVisibleDoc) return;
    try {
        let query = pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .limit(pastesPerPage);
        if (delta === 1) query = query.startAfter(lastVisibleDoc);
        else if (delta === -1) query = query.endBefore(firstVisibleDoc).limitToLast(pastesPerPage);
        const snapshot = await query.get();
        if (snapshot.docs.length > 0) {
            lastVisibleDoc = snapshot.docs[snapshot.docs.length - 1];
            firstVisibleDoc = snapshot.docs[0];
            currentPage += delta;
        }
        displayPastesTable(snapshot, 'all-pastes-body', false);
        updatePagination();
    } catch (error) {
        console.error('Error changing page:', error);
    }
}

function displayPastesTable(snapshot, containerId, isPinned = false) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    if (snapshot.empty) {
        container.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 2rem;">No pastes found</td></tr>';
        return;
    }
    snapshot.forEach(doc => {
        const paste = doc.data();
        const pasteId = doc.id;
        const row = document.createElement('tr');
        row.className = isPinned ? 'pinned-row' : '';
        row.onclick = () => showPasteDetail(pasteId);
        const date = paste.timestamp?.toDate();
        const dateStr = date ? formatDate(date) : 'Unknown';
        row.innerHTML = `
            <td class="paste-title">${escapeHtml(paste.title)}</td>
            <td class="paste-comments">0</td>
            <td class="paste-views">${paste.views || 0}</td>
            <td class="paste-author" onclick="event.stopPropagation(); showUserProfile('${paste.userId}')">
                ${escapeHtml(paste.username || 'Anonymous')}
            </td>
            <td class="paste-date">${dateStr}</td>
        `;
        container.appendChild(row);
    });
}

function updatePagination() {
    const pageInfo = document.getElementById('page-info');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
    prevBtn.disabled = currentPage <= 1;
    nextBtn.disabled = currentPage >= totalPages;
}

function formatDate(date) {
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    return `${months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
}

async function signIn() {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    if (!email || !password) {
        showAlert('Please enter both email and password', 'error');
        return;
    }
    try {
        const userCredential = await pasteAuth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        await checkUserStatus();
        updateUIForAuth();
        await checkTimeoutStatus();
        showAlert('Successfully signed in!', 'success');
        showPage('home');
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function signUp() {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    if (!email || !password) {
        showAlert('Please enter both email and password', 'error');
        return;
    }
    if (password.length < 6) {
        showAlert('Password must be at least 6 characters', 'error');
        return;
    }
    try {
        const userCredential = await pasteAuth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        const userData = {
            email: email,
            username: email.split('@')[0],
            displayName: email.split('@')[0],
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            isBanned: false,
            isAdmin: email === 'exoticslash3r@gmail.com',
            isManager: false,
            isVip: false,
            isTagMaker: false,
            usernameColor: '#ffffff',
            bannerUrl: '',
            profileUrl: '',
            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
        };
        await pasteDb.collection('users').doc(currentUser.uid).set(userData);
        await checkUserStatus();
        updateUIForAuth();
        showAlert('Account created successfully!', 'success');
        showPage('home');
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

function signOut() {
    pasteAuth.signOut().then(() => {
        currentUser = null;
        isAdmin = false;
        isManager = false;
        isVip = false;
        isTagMaker = false;
        updateUIForAuth();
        showAlert('Signed out successfully', 'success');
        showPage('home');
    });
}

async function checkUserStatus() {
    if (!currentUser) {
        isAdmin = false;
        isManager = false;
        isVip = false;
        isTagMaker = false;
        return;
    }
    try {
        const userDoc = await pasteDb.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
            const userData = userDoc.data();
            isAdmin = userData.isAdmin || currentUser.email === 'exoticslash3r@gmail.com';
            isManager = userData.isManager || false;
            isVip = userData.isVip || false;
            isTagMaker = userData.isTagMaker || false;
            if (currentUser.email === 'exoticslash3r@gmail.com' && !userData.isAdmin) {
                await pasteDb.collection('users').doc(currentUser.uid).update({ isAdmin: true });
            }
        } else {
            const userData = {
                email: currentUser.email,
                username: currentUser.email.split('@')[0],
                displayName: currentUser.email.split('@')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                isBanned: false,
                isAdmin: currentUser.email === 'exoticslash3r@gmail.com',
                isManager: false,
                isVip: false,
                isTagMaker: false,
                usernameColor: '#ffffff',
                bannerUrl: '',
                profileUrl: '',
                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            };
            await pasteDb.collection('users').doc(currentUser.uid).set(userData);
            isAdmin = currentUser.email === 'exoticslash3r@gmail.com';
        }
    } catch (error) {
        console.error('Error checking user status:', error);
    }
}

function updateUIForAuth() {
    const authBtn = document.getElementById('authBtn');
    const myAccountBtn = document.getElementById('myAccountBtn');
    const adminBtn = document.getElementById('adminBtn');
    const managerBtn = document.getElementById('managerBtn');
    const tagMakerBtn = document.getElementById('tagMakerBtn');
    const usernameDisplay = document.getElementById('usernameDisplay');
    if (currentUser) {
        authBtn.textContent = 'Sign Out';
        authBtn.onclick = signOut;
        myAccountBtn.classList.remove('hidden');
        pasteDb.collection('users').doc(currentUser.uid).get().then(doc => {
            if (doc.exists) {
                const userData = doc.data();
                let username = userData.displayName || userData.username || currentUser.email.split('@')[0];
                let color = userData.usernameColor || '#ffffff';
                let badges = '';
                if (userData.isAdmin) badges += '<span class="role-badge owner-badge">OWNER</span>';
                if (userData.isManager) badges += '<span class="role-badge manager-badge">MANAGER</span>';
                if (userData.isVip) badges += '<span class="role-badge vip-badge">VIP</span>';
                if (userData.isTagMaker) badges += '<span class="role-badge tagmaker-badge">TAG MAKER</span>';
                usernameDisplay.innerHTML = `<span style="color: ${color};">${escapeHtml(username)}</span>${badges}`;
                if (isAdmin) {
                    adminBtn.classList.remove('hidden');
                    showAlert('Owner privileges activated!', 'success');
                } else adminBtn.classList.add('hidden');
                if (isManager) {
                    managerBtn.classList.remove('hidden');
                    showAlert('Manager privileges activated!', 'success');
                } else managerBtn.classList.add('hidden');
                if (isTagMaker) tagMakerBtn.classList.remove('hidden');
                else tagMakerBtn.classList.add('hidden');
                if (isVip) {
                    document.getElementById('color-picker').classList.remove('hidden');
                    document.getElementById('updateColorBtn').classList.remove('hidden');
                } else {
                    document.getElementById('color-picker').classList.add('hidden');
                    document.getElementById('updateColorBtn').classList.add('hidden');
                }
            } else {
                usernameDisplay.textContent = currentUser.email.split('@')[0];
            }
        });
    } else {
        authBtn.textContent = 'Sign In';
        authBtn.onclick = () => showPage('auth');
        myAccountBtn.classList.add('hidden');
        adminBtn.classList.add('hidden');
        managerBtn.classList.add('hidden');
        tagMakerBtn.classList.add('hidden');
        usernameDisplay.textContent = '';
    }
}

async function publishPaste() {
    if (!currentUser) {
        showAlert('Please sign in to publish pastes', 'error');
        showPage('auth');
        return;
    }
    const title = document.getElementById('paste-title').value.trim();
    const content = document.getElementById('paste-content').value.trim();
    if (!title || !content) {
        showAlert('Please fill in both title and content', 'error');
        return;
    }
    try {
        const userDoc = await pasteDb.collection('users').doc(currentUser.uid).get();
        let userData = userDoc.exists ? userDoc.data() : {
            email: currentUser.email,
            username: currentUser.email.split('@')[0],
            displayName: currentUser.email.split('@')[0]
        };
        const pasteData = {
            title: title,
            content: content,
            username: userData.displayName || userData.username || currentUser.email.split('@')[0],
            userId: currentUser.uid,
            views: 0,
            commentCount: 0,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            isPinned: false,
            isRemoved: false,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        };
        await pasteDb.collection('pastes').add(pasteData);
        showAlert('Paste published successfully!', 'success');
        clearPasteForm();
        loadAllPastes();
        showPage('home');
    } catch (error) {
        showAlert(`Error publishing paste: ${error.message}`, 'error');
    }
}

function clearPasteForm() {
    document.getElementById('paste-title').value = '';
    document.getElementById('paste-content').value = '';
}

async function sendChatMessage() {
    if (!currentUser) {
        showAlert('Please sign in to chat', 'error');
        showPage('auth');
        return;
    }
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    if (!message) return;
    try {
        const userDoc = await pasteDb.collection('users').doc(currentUser.uid).get();
        let username = currentUser.email.split('@')[0];
        let color = '#ffffff';
        if (userDoc.exists) {
            const userData = userDoc.data();
            username = userData.displayName || userData.username || username;
            color = userData.usernameColor || color;
        }
        await chatDb.collection('messages').add({
            message: message,
            username: username,
            userId: currentUser.uid,
            usernameColor: color,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        input.value = '';
    } catch (error) {
        showAlert(`Error sending message: ${error.message}`, 'error');
    }
}

function loadChatMessages() {
    chatDb.collection('messages')
        .orderBy('timestamp', 'desc')
        .limit(100)
        .onSnapshot(snapshot => {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            const messages = [];
            snapshot.forEach(doc => messages.push({ id: doc.id, ...doc.data() }));
            messages.sort((a, b) => b.timestamp - a.timestamp);
            if (messages.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #888;">No messages yet</div>';
                return;
            }
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-sender" style="color: ${msg.usernameColor || '#ffffff'}">
                            ${escapeHtml(msg.username || 'Unknown User')}:
                        </div>
                        <div class="message-time">${formatTime(msg.timestamp?.toDate())}</div>
                    </div>
                    <div>${escapeHtml(msg.message)}</div>
                `;
                container.appendChild(messageDiv);
            });
            container.scrollTop = container.scrollHeight;
        });
}

async function loadAdminStats() {
    if (!isAdmin) {
        showAlert('Admin access required', 'error');
        showPage('home');
        return;
    }
    try {
        const usersSnap = await pasteDb.collection('users').get();
        const pastesSnap = await pasteDb.collection('pastes').where('isRemoved', '==', false).get();
        const pinnedSnap = await pasteDb.collection('pastes').where('isPinned', '==', true).where('isRemoved', '==', false).get();
        const now = new Date();
        const timedOutUsers = usersSnap.docs.filter(doc => {
            const userData = doc.data();
            return userData.timeoutUntil && userData.timeoutUntil.toDate() > now;
        }).length;
        document.getElementById('totalUsers').textContent = usersSnap.size;
        document.getElementById('totalPastes').textContent = pastesSnap.size;
        document.getElementById('bannedUsers').textContent = usersSnap.docs.filter(doc => doc.data().isBanned).length;
        document.getElementById('pinnedPastes').textContent = pinnedSnap.size;
        document.getElementById('timedOutUsers').textContent = timedOutUsers;
    } catch (error) {
        console.error('Error loading admin stats:', error);
    }
}

async function adminViewAllUsers() {
    if (!isAdmin) return;
    try {
        const snapshot = await pasteDb.collection('users').orderBy('createdAt', 'desc').get();
        const container = document.getElementById('admin-content');
        let html = '<h3>All Users:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Username</th><th>Email</th><th>Roles</th><th>Joined</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const user = doc.data();
            html += `<tr>
                <td>${escapeHtml(user.displayName || user.username || user.email?.split('@')[0])}</td>
                <td>${escapeHtml(user.email || 'No email')}</td>
                <td>${user.isAdmin ? 'Owner ' : ''}${user.isManager ? 'Manager ' : ''}${user.isVip ? 'VIP ' : ''}${user.isTagMaker ? 'TagMaker ' : ''}</td>
                <td>${formatTime(user.createdAt?.toDate())}</td>
                <td>
                    <button class="btn btn-danger" onclick="adminBanUser('${doc.id}', ${!user.isBanned})">${user.isBanned ? 'Unban' : 'Ban'}</button>
                    <button class="btn btn-warning" onclick="toggleUserRole('${doc.id}', 'isManager', ${!user.isManager})">${user.isManager ? 'Remove Manager' : 'Make Manager'}</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminViewAllPastes() {
    if (!isAdmin) return;
    try {
        const snapshot = await pasteDb.collection('pastes').orderBy('timestamp', 'desc').limit(100).get();
        const container = document.getElementById('admin-content');
        let html = '<h3>All Pastes:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Title</th><th>Author</th><th>Views</th><th>Date</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const paste = doc.data();
            html += `<tr>
                <td>${escapeHtml(paste.title)}</td>
                <td>${escapeHtml(paste.username || 'Anonymous')}</td>
                <td>${paste.views || 0}</td>
                <td>${formatTime(paste.timestamp?.toDate())}</td>
                <td>
                    <button class="btn btn-success" onclick="adminPinPaste('${doc.id}', ${!paste.isPinned})">${paste.isPinned ? 'Unpin' : 'Pin'}</button>
                    <button class="btn btn-danger" onclick="adminRemovePaste('${doc.id}')">Remove</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminClearChat() {
    if (!isAdmin) return;
    if (confirm('Clear ALL chat messages?')) {
        try {
            const snapshot = await chatDb.collection('messages').get();
            const batch = chatDb.batch();
            snapshot.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
            showAlert('Chat cleared', 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminBackupData() {
    if (!isAdmin) return;
    showAlert('Backup feature would export data here', 'success');
}

async function adminManageRoles() {
    if (!isAdmin) return;
    try {
        const snapshot = await pasteDb.collection('users').get();
        const container = document.getElementById('admin-content');
        let html = '<h3>Manage User Roles:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Username</th><th>Email</th><th>Current Roles</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const user = doc.data();
            html += `<tr>
                <td>${escapeHtml(user.displayName || user.username || user.email?.split('@')[0])}</td>
                <td>${escapeHtml(user.email || 'No email')}</td>
                <td>${user.isAdmin ? 'Owner ' : ''}${user.isManager ? 'Manager ' : ''}${user.isVip ? 'VIP ' : ''}${user.isTagMaker ? 'TagMaker ' : ''}</td>
                <td>
                    <button class="btn btn-warning" onclick="toggleUserRole('${doc.id}', 'isManager', ${!user.isManager})">${user.isManager ? 'Remove Manager' : 'Make Manager'}</button>
                    <button class="btn btn-warning" onclick="toggleUserRole('${doc.id}', 'isVip', ${!user.isVip})">${user.isVip ? 'Remove VIP' : 'Make VIP'}</button>
                    <button class="btn btn-warning" onclick="toggleUserRole('${doc.id}', 'isTagMaker', ${!user.isTagMaker})">${user.isTagMaker ? 'Remove TagMaker' : 'Make TagMaker'}</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function toggleUserRole(userId, role, value) {
    if (!isAdmin) return;
    try {
        await pasteDb.collection('users').doc(userId).update({ [role]: value });
        showAlert(`User role updated successfully!`, 'success');
        adminManageRoles();
    } catch (error) {
        showAlert(`Error updating role: ${error.message}`, 'error');
    }
}

async function managerViewUsers() {
    if (!isManager) return;
    try {
        const snapshot = await pasteDb.collection('users').orderBy('createdAt', 'desc').get();
        const container = document.getElementById('manager-content');
        let html = '<h3>All Users:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Username</th><th>Email</th><th>Status</th><th>Joined</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const user = doc.data();
            html += `<tr>
                <td>${escapeHtml(user.displayName || user.username || user.email?.split('@')[0])}</td>
                <td>${escapeHtml(user.email || 'No email')}</td>
                <td>${user.isBanned ? 'Banned' : 'Active'} ${user.isAdmin ? '| Owner' : ''} ${user.isManager ? '| Manager' : ''}</td>
                <td>${formatTime(user.createdAt?.toDate())}</td>
                <td>
                    <button class="btn btn-danger" onclick="adminBanUser('${doc.id}', ${!user.isBanned})">${user.isBanned ? 'Unban' : 'Ban'}</button>
                    <button class="btn btn-warning" onclick="showPage(\'timeout\'); setTimeout(() => document.getElementById(\'timeout-user-select\').value = \'${doc.id}\', 100)">Timeout</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function managerViewPastes() {
    if (!isManager) return;
    try {
        const snapshot = await pasteDb.collection('pastes').where('isRemoved', '==', false).orderBy('timestamp', 'desc').limit(50).get();
        const container = document.getElementById('manager-content');
        let html = '<h3>All Pastes:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Title</th><th>Author</th><th>Views</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const paste = doc.data();
            html += `<tr>
                <td>${escapeHtml(paste.title)}</td>
                <td>${escapeHtml(paste.username || 'Anonymous')}</td>
                <td>${paste.views || 0}</td>
                <td>${formatTime(paste.timestamp?.toDate())}</td>
                <td>${paste.isPinned ? 'Pinned' : 'Normal'}</td>
                <td>
                    <button class="btn btn-success" onclick="adminPinPaste('${doc.id}', ${!paste.isPinned})">${paste.isPinned ? 'Unpin' : 'Pin'}</button>
                    <button class="btn btn-danger" onclick="adminRemovePaste('${doc.id}')">Remove</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function managerClearChat() {
    if (!isManager) return;
    if (confirm('Clear ALL chat messages?')) {
        try {
            const snapshot = await chatDb.collection('messages').get();
            const batch = chatDb.batch();
            snapshot.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
            showAlert('Chat cleared', 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function managerViewAllPastes() {
    if (!isManager) return;
    try {
        const snapshot = await pasteDb.collection('pastes').orderBy('timestamp', 'desc').limit(100).get();
        const container = document.getElementById('manager-content');
        let html = '<h3>Manage Pastes:</h3><div class="paste-table-container"><table class="paste-table"><thead><tr><th>Title</th><th>Author</th><th>Views</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead><tbody>';
        snapshot.forEach(doc => {
            const paste = doc.data();
            html += `<tr>
                <td>${escapeHtml(paste.title)}</td>
                <td>${escapeHtml(paste.username || 'Anonymous')}</td>
                <td>${paste.views || 0}</td>
                <td>${formatTime(paste.timestamp?.toDate())}</td>
                <td>${paste.isPinned ? 'Pinned' : 'Normal'} ${paste.isRemoved ? '| Removed' : ''}</td>
                <td>
                    <button class="btn btn-success" onclick="adminPinPaste('${doc.id}', ${!paste.isPinned})">${paste.isPinned ? 'Unpin' : 'Pin'}</button>
                    <button class="btn btn-danger" onclick="adminRemovePaste('${doc.id}')">Remove</button>
                </td>
            </tr>`;
        });
        html += '</tbody></table></div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function loadTimeoutUsers() {
    try {
        const select = document.getElementById('timeout-user-select');
        select.innerHTML = '<option value="">-- Select a user --</option>';
        const snapshot = await pasteDb.collection('users').get();
        snapshot.forEach(doc => {
            const user = doc.data();
            const option = document.createElement('option');
            option.value = doc.id;
            option.textContent = `${user.displayName || user.username || user.email?.split('@')[0]} (${user.email})`;
            select.appendChild(option);
        });
        await loadTimedOutList();
    } catch (error) {
        console.error('Error loading users:', error);
    }
}

async function loadTimedOutList() {
    try {
        const now = new Date();
        const snapshot = await pasteDb.collection('users').get();
        const container = document.getElementById('timed-out-table-body');
        container.innerHTML = '';
        let hasTimedOut = false;
        snapshot.forEach(doc => {
            const user = doc.data();
            if (user.timeoutUntil) {
                const timeoutUntil = user.timeoutUntil.toDate();
                if (timeoutUntil > now) {
                    hasTimedOut = true;
                    const diff = timeoutUntil - now;
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                    let timeStr = '';
                    if (days > 0) timeStr += `${days}d `;
                    if (hours > 0) timeStr += `${hours}h `;
                    if (minutes > 0) timeStr += `${minutes}m `;
                    timeStr += `${seconds}s`;
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${escapeHtml(user.displayName || user.username || user.email?.split('@')[0])}</td>
                        <td>${timeStr}</td>
                        <td>${user.timeoutReason || 'No reason provided'}</td>
                        <td><button class="btn btn-success" onclick="untimeoutSpecificUser('${doc.id}')">Remove Timeout</button></td>
                    `;
                    container.appendChild(row);
                }
            }
        });
        if (!hasTimedOut) {
            container.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">No users are currently timed out</td></tr>';
        }
    } catch (error) {
        console.error('Error loading timed out users:', error);
    }
}

async function timeoutUser() {
    if (!isAdmin && !isManager) {
        showAlert('You do not have permission to timeout users', 'error');
        return;
    }
    const userId = document.getElementById('timeout-user-select').value;
    const days = parseInt(document.getElementById('timeout-days').value) || 0;
    const hours = parseInt(document.getElementById('timeout-hours').value) || 0;
    const minutes = parseInt(document.getElementById('timeout-minutes').value) || 0;
    const seconds = parseInt(document.getElementById('timeout-seconds').value) || 0;
    const reason = document.getElementById('timeout-reason-input').value.trim();
    if (!userId) {
        showAlert('Please select a user', 'error');
        return;
    }
    if (days === 0 && hours === 0 && minutes === 0 && seconds === 0) {
        showAlert('Please enter a timeout duration', 'error');
        return;
    }
    const totalMs = (days * 24 * 60 * 60 * 1000) + (hours * 60 * 60 * 1000) + (minutes * 60 * 1000) + (seconds * 1000);
    const timeoutUntil = new Date(Date.now() + totalMs);
    try {
        await pasteDb.collection('users').doc(userId).update({
            timeoutUntil: timeoutUntil,
            timeoutReason: reason || 'No reason provided'
        });
        showAlert('User has been timed out', 'success');
        loadTimedOutList();
        document.getElementById('timeout-days').value = '';
        document.getElementById('timeout-hours').value = '';
        document.getElementById('timeout-minutes').value = '';
        document.getElementById('timeout-seconds').value = '';
        document.getElementById('timeout-reason-input').value = '';
    } catch (error) {
        showAlert(`Error timing out user: ${error.message}`, 'error');
    }
}

async function untimeoutUser() {
    if (!isAdmin && !isManager) {
        showAlert('You do not have permission to remove timeouts', 'error');
        return;
    }
    const userId = document.getElementById('timeout-user-select').value;
    if (!userId) {
        showAlert('Please select a user', 'error');
        return;
    }
    try {
        await pasteDb.collection('users').doc(userId).update({
            timeoutUntil: null,
            timeoutReason: null
        });
        showAlert('User timeout has been removed', 'success');
        loadTimedOutList();
    } catch (error) {
        showAlert(`Error removing timeout: ${error.message}`, 'error');
    }
}

async function untimeoutSpecificUser(userId) {
    if (!isAdmin && !isManager) {
        showAlert('You do not have permission to remove timeouts', 'error');
        return;
    }
    try {
        await pasteDb.collection('users').doc(userId).update({
            timeoutUntil: null,
            timeoutReason: null
        });
        showAlert('User timeout has been removed', 'success');
        loadTimedOutList();
    } catch (error) {
        showAlert(`Error removing timeout: ${error.message}`, 'error');
    }
}

function handleSearch() {
    const searchTerm = document.getElementById('searchBar').value.trim();
    const resultsDiv = document.getElementById('searchResults');
    if (searchTerm.length === 0) {
        resultsDiv.classList.add('hidden');
        return;
    }
    if (searchTimeout) clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => performSearch(searchTerm), 300);
    resultsDiv.classList.remove('hidden');
}

async function performSearch(searchTerm) {
    const resultsContent = document.getElementById('searchResultsContent');
    resultsContent.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 1rem;">Searching...</td></tr>';
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .limit(50)
            .get();
        const results = [];
        const searchLower = searchTerm.toLowerCase();
        snapshot.forEach(doc => {
            const paste = doc.data();
            const pasteId = doc.id;
            const titleMatch = paste.title.toLowerCase().includes(searchLower);
            const contentMatch = paste.content.toLowerCase().includes(searchLower);
            const userMatch = (paste.username || '').toLowerCase().includes(searchLower);
            if (titleMatch || contentMatch || userMatch) results.push({ id: pasteId, ...paste });
        });
        displaySearchResults(results, resultsContent);
    } catch (error) {
        resultsContent.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 1rem; color: #ff0000;">Error loading search results</td></tr>';
    }
}

function displaySearchResults(results, container) {
    container.innerHTML = '';
    if (results.length === 0) {
        container.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">No results found</td></tr>';
        return;
    }
    results.slice(0, 10).forEach(paste => {
        const row = document.createElement('tr');
        row.onclick = () => {
            showPasteDetail(paste.id);
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('searchBar').value = '';
        };
        row.innerHTML = `
            <td class="paste-title">${escapeHtml(paste.title)}</td>
            <td class="paste-views">${paste.views || 0}</td>
            <td class="paste-author">${escapeHtml(paste.username || 'Anonymous')}</td>
            <td class="paste-date">${formatDate(paste.timestamp?.toDate())}</td>
        `;
        container.appendChild(row);
    });
}

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatTime(date) {
    if (!date) return 'Unknown';
    const now = new Date();
    const diff = now - date;
    if (diff < 60000) return 'Just now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;
    return date.toLocaleDateString();
}

document.addEventListener('DOMContentLoaded', () => {
    const logo = document.querySelector('.logo');
    if (logo) {
        logo.src = "https://i.postimg.cc/x8ML5hVd/logo.jpg";
        logo.onerror = function() {
            this.src = 'https://via.placeholder.com/300x100/000000/ffffff?text=NORBIN+LOGO';
        };
    }
    pasteAuth.onAuthStateChanged(async (user) => {
        currentUser = user;
        if (user) {
            await checkUserStatus();
        } else {
            isAdmin = false;
            isManager = false;
            isVip = false;
            isTagMaker = false;
        }
        updateUIForAuth();
        loadPinnedPastes();
        loadAllPastes();
    });
    showPage('home');
    document.addEventListener('click', (event) => {
        const menu = document.getElementById('slideDownMenu');
        const hamburger = document.querySelector('.hamburger-btn');
        if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
            menu.classList.remove('active');
        }
    });
});
</script>
</body>
</html>
