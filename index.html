<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Norbin</title>
<style>
/* Black and White Theme - Doxbin Style */
:root {
    --bg-color: #0a0a0a;
    --text-color: #ffffff;
    --accent-color: #ffffff;
    --card-bg: #111111;
    --border-color: #333333;
    --hover-color: #222222;
    --table-header-bg: #1a1a1a;
    --table-row-alt: #0d0d0d;
    --table-border: #2a2a2a;
    --link-color: #4dabf7;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    transition: all 0.3s ease;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #000000;
}

::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Role Glow Effects */
.owner-glow {
    text-shadow: 
        0 0 10px #ff0000,
        0 0 20px #ff0000,
        0 0 30px #ff0000,
        0 0 40px #ff0000;
    animation: bloodPulse 2s infinite;
}

.vip-glow {
    text-shadow: 
        0 0 10px #ffd700,
        0 0 20px #ffd700,
        0 0 30px #ffd700;
}

@keyframes bloodPulse {
    0% { text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000; }
    50% { text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, 0 0 60px #ff0000; }
    100% { text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000; }
}

/* NEW: Doxbin Style Table */
.doxbin-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    background: var(--bg-color);
    border: 1px solid var(--table-border);
}

.doxbin-table thead {
    background: var(--table-header-bg);
}

.doxbin-table th {
    padding: 12px 15px;
    text-align: left;
    font-weight: bold;
    color: var(--accent-color);
    border-bottom: 2px solid var(--table-border);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.doxbin-table td {
    padding: 12px 15px;
    border-bottom: 1px solid var(--table-border);
    font-size: 0.9rem;
}

.doxbin-table tbody tr:nth-child(odd) {
    background: var(--table-row-alt);
}

.doxbin-table tbody tr:nth-child(even) {
    background: var(--bg-color);
}

.doxbin-table tbody tr:hover {
    background: var(--hover-color);
}

.doxbin-table tbody tr:last-child td {
    border-bottom: none;
}

/* NEW: Clickable paste links */
.paste-link {
    color: var(--link-color);
    text-decoration: none;
    font-weight: 500;
    cursor: pointer;
}

.paste-link:hover {
    text-decoration: underline;
    color: #6bbfff;
}

.paste-title-link {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: bold;
    cursor: pointer;
    display: block;
}

.paste-title-link:hover {
    color: var(--link-color);
    text-decoration: underline;
}

/* NEW: Share link section */
.share-section {
    background: var(--table-row-alt);
    padding: 1rem;
    border: 1px solid var(--table-border);
    margin: 1.5rem 0;
    border-radius: 2px;
}

.share-link-container {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.share-link {
    flex: 1;
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    padding: 0.8rem;
    color: var(--text-color);
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    border-radius: 2px;
    user-select: all;
}

.copy-btn {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 2px;
    font-size: 0.9rem;
    transition: all 0.3s;
    white-space: nowrap;
}

.copy-btn:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.copy-btn.copied {
    background: #00aa00;
    border-color: #00aa00;
    color: white;
}

/* NEW: Comments and Views styling */
.comments-count, .views-count {
    font-weight: bold;
    color: #888;
    cursor: pointer;
}

.comments-count:hover, .views-count:hover {
    color: var(--accent-color);
}

/* NEW: Badge styling (Manager, VIP, etc) */
.badge {
    display: inline-block;
    padding: 2px 6px;
    font-size: 0.7rem;
    font-weight: bold;
    border-radius: 2px;
    margin-left: 5px;
    vertical-align: middle;
}

.badge-manager {
    background: #ff8800;
    color: white;
}

.badge-admin {
    background: #ff0000;
    color: white;
}

.badge-vip {
    background: #ffd700;
    color: black;
}

.badge-tagmaker {
    background: #8800ff;
    color: white;
}

.badge-owner {
    background: #ff0000;
    color: white;
    animation: bloodPulse 2s infinite;
}

.badge-pinned {
    background: #00aa00;
    color: white;
}

/* NEW: Pagination Styles - Clean Doxbin Style */
.pagination-container {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 2rem 0;
    gap: 0.5rem;
}

.pagination-btn {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    width: 36px;
    height: 36px;
    border-radius: 2px;
    cursor: pointer;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.pagination-btn:hover:not(:disabled) {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.pagination-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.pagination-pages {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.page-number {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    width: 36px;
    height: 36px;
    border-radius: 2px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: normal;
    font-size: 0.9rem;
    transition: all 0.3s;
}

.page-number:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.page-number.active {
    background: var(--link-color);
    color: white;
    border-color: var(--link-color);
}

.page-ellipsis {
    color: #888;
    font-size: 1rem;
    margin: 0 0.5rem;
}

.pagination-info {
    text-align: center;
    color: #888;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}

/* Timeout Fullscreen */
.timeout-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.95);
    z-index: 99999;
    display: none;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
    padding: 2rem;
}

.timeout-overlay.active {
    display: flex;
}

.timeout-message {
    font-size: 3rem;
    color: #ff0000;
    margin-bottom: 2rem;
    text-shadow: 0 0 20px #ff0000;
    animation: pulse 1.5s infinite;
}

.timeout-details {
    font-size: 1.5rem;
    color: #ffffff;
    margin-bottom: 3rem;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Navbar */
.navbar {
    background-color: #000000;
    padding: 0.8rem 1.5rem;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1000;
    border-bottom: 1px solid var(--table-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 50px;
}

.hamburger-btn {
    background: none;
    border: none;
    color: var(--accent-color);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.4rem;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.hamburger-btn:hover {
    background: var(--hover-color);
    border-radius: 2px;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.username-display {
    font-weight: bold;
    font-size: 0.9rem;
}

/* Slide Down Menu - Updated Layout */
.slide-down-menu {
    position: fixed;
    top: -100%;
    left: 0;
    width: 100%;
    background-color: #000000;
    z-index: 999;
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid var(--table-border);
    transition: top 0.5s ease;
}

.slide-down-menu.active {
    top: 50px;
}

.menu-items {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    max-width: 1200px;
    margin: 0 auto;
}

.menu-btn {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    padding: 0.6rem 1rem;
    text-align: left;
    font-size: 0.9rem;
    cursor: pointer;
    border-radius: 2px;
    transition: all 0.3s;
    width: 100%;
    margin: 0;
    position: relative;
    overflow: hidden;
}

.menu-btn:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
    transform: translateX(3px);
}

.hidden {
    display: none !important;
}

/* Main Content */
.main-content {
    padding-top: 70px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 70px 1.5rem 1.5rem;
    min-height: calc(100vh - 70px);
}

/* Logo and Search */
.logo-container {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--table-border);
}

.logo {
    max-width: 200px;
    height: auto;
    margin: 0.8rem auto;
}

/* Search Container */
.search-container {
    max-width: 600px;
    margin: 0 auto 2rem;
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.search-wrapper {
    flex: 1;
    display: flex;
    gap: 0.5rem;
}

.search-bar {
    flex: 1;
    padding: 0.8rem 1rem;
    border: 1px solid var(--table-border);
    border-radius: 2px;
    background: var(--bg-color);
    color: var(--accent-color);
    font-size: 0.9rem;
    outline: none;
    height: 40px;
}

.search-bar::placeholder {
    color: #666;
    font-size: 0.9rem;
}

.search-btn {
    padding: 0.8rem 1.5rem;
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: normal;
    height: 40px;
    white-space: nowrap;
    transition: all 0.3s;
}

.search-btn:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

/* Pinned Pastes Section */
.pinned-pastes {
    margin-bottom: 2rem;
}

.pastes-table-container {
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 0.8rem;
}

/* Recent Pastes */
.section-title {
    color: var(--accent-color);
    font-size: 1.2rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--table-border);
}

/* FULLSCREEN PASTE DETAIL - DOXBIN STYLE */
.paste-detail-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--bg-color);
    z-index: 9999;
    padding: 15px;
    overflow-y: auto;
    display: none;
}

.paste-detail-container.active {
    display: block;
}

.paste-detail-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(10, 10, 10, 0.95);
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid var(--table-border);
    z-index: 10000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 50px;
}

.paste-detail-content {
    margin-top: 60px;
    padding: 1.5rem;
    max-width: 1000px;
    margin-left: auto;
    margin-right: auto;
}

.back-btn {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 2px;
    font-size: 0.9rem;
    transition: all 0.3s;
    height: 36px;
}

.back-btn:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.paste-content {
    white-space: pre-wrap;
    font-family: 'Courier New', monospace;
    background: var(--bg-color);
    padding: 1.5rem;
    border-radius: 2px;
    border: 1px solid var(--table-border);
    margin-top: 1rem;
    min-height: 150px;
    max-height: calc(100vh - 250px);
    overflow-y: auto;
    line-height: 1.5;
    font-size: 0.95rem;
}

/* Forms */
.paste-form, .auth-form, .profile-form, .timeout-form, .tag-form, .username-color-form {
    max-width: 700px;
    margin: 0 auto;
    background: var(--table-row-alt);
    padding: 1.5rem;
    border-radius: 2px;
    border: 1px solid var(--table-border);
}

.form-group {
    margin-bottom: 1.2rem;
}

.form-label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: bold;
    color: var(--accent-color);
    font-size: 0.9rem;
}

.form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 0.8rem;
    border: 1px solid var(--table-border);
    border-radius: 2px;
    background: var(--bg-color);
    color: var(--accent-color);
    font-size: 0.9rem;
    outline: none;
}

.form-textarea {
    min-height: 300px;
    font-family: 'Courier New', monospace;
    resize: vertical;
}

.url-input-group {
    display: flex;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
}

.url-input {
    flex: 1;
    padding: 0.8rem;
    border: 1px solid var(--table-border);
    border-radius: 2px;
    background: var(--bg-color);
    color: var(--accent-color);
    font-size: 0.9rem;
}

.time-input-group {
    display: flex;
    gap: 0.8rem;
}

.time-input {
    flex: 1;
    font-size: 0.9rem;
}

/* Buttons */
.btn {
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 2px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: normal;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.btn-small {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
    height: 32px;
}

.btn-primary {
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
}

.btn-primary:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.btn-secondary {
    background: #222222;
    color: var(--accent-color);
    border: 1px solid #666666;
}

.btn-secondary:hover {
    background: #333333;
}

.btn-danger {
    background: #ff0000;
    color: white;
    border: 1px solid #ff0000;
}

.btn-danger:hover {
    background: #cc0000;
}

.btn-success {
    background: #00aa00;
    color: white;
    border: 1px solid #00aa00;
}

.btn-success:hover {
    background: #008800;
}

.btn-warning {
    background: #ffaa00;
    color: black;
    border: 1px solid #ffaa00;
}

.btn-warning:hover {
    background: #ff9900;
}

.btn-gold {
    background: #ffd700;
    color: #000000;
    border: 1px solid #ffd700;
}

.btn-gold:hover {
    background: #ffed4e;
}

.btn-group {
    display: flex;
    gap: 0.8rem;
    margin-top: 0.8rem;
}

/* Chat Page */
.chat-container {
    max-width: 900px;
    margin: 0 auto;
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    height: 500px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.chat-header {
    background: var(--table-header-bg);
    padding: 0.8rem;
    border-bottom: 1px solid var(--table-border);
    text-align: center;
    font-size: 1rem;
    color: var(--accent-color);
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 0.8rem;
    background: var(--bg-color);
}

.message {
    margin-bottom: 0.8rem;
    padding: 0.8rem;
    background: var(--table-row-alt);
    border-radius: 2px;
    border-left: 2px solid var(--table-border);
    font-size: 0.9rem;
}

.message-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.4rem;
}

.message-sender {
    font-weight: bold;
    color: var(--accent-color);
    font-size: 0.85rem;
}

.message-time {
    color: #888888;
    font-size: 0.8rem;
}

.chat-input-container {
    padding: 0.8rem;
    background: var(--table-header-bg);
    border-top: 1px solid var(--table-border);
}

.chat-input-wrapper {
    display: flex;
    gap: 0.8rem;
}

.chat-input {
    flex: 1;
    padding: 0.8rem;
    border: 1px solid var(--table-border);
    border-radius: 2px;
    background: var(--bg-color);
    color: var(--accent-color);
    font-size: 0.9rem;
    outline: none;
    height: 36px;
}

.send-btn {
    padding: 0.8rem 1.5rem;
    background: var(--table-header-bg);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    cursor: pointer;
    font-weight: normal;
    font-size: 0.9rem;
    height: 36px;
}

.send-btn:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

/* Hall of Autism */
.hall-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-top: 1.5rem;
}

@media (max-width: 1200px) {
    .hall-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .hall-grid {
        grid-template-columns: 1fr;
    }
}

.hall-box {
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 1.2rem;
    text-align: center;
    transition: all 0.3s;
}

.hall-box:hover {
    transform: translateY(-2px);
    border-color: var(--link-color);
}

.hall-image {
    width: 100%;
    height: 150px;
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    margin-bottom: 0.8rem;
    border-radius: 2px;
    overflow: hidden;
}

.hall-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.hall-name {
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 0.4rem;
    color: var(--accent-color);
}

.hall-description {
    color: #888888;
    font-size: 0.8rem;
}

/* Profile Page */
.profile-banner {
    height: 150px;
    background: var(--bg-color);
    border-radius: 2px;
    margin-bottom: 1.5rem;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--table-border);
}

.profile-banner-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-picture {
    width: 80px;
    height: 80px;
    background: var(--bg-color);
    position: absolute;
    bottom: -40px;
    left: 1.5rem;
    border: 1px solid var(--table-border);
    border-radius: 2px;
    overflow: hidden;
}

.profile-picture-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Admin Panel */
.admin-controls {
    background: var(--table-row-alt);
    border: 1px solid #ff0000;
    border-radius: 2px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}

.admin-title {
    color: #ff0000;
    font-size: 1.2rem;
    margin-bottom: 1.2rem;
    border-bottom: 1px solid #ff0000;
    padding-bottom: 0.4rem;
}

.admin-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

.stat-box {
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 0.8rem;
    text-align: center;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--accent-color);
}

.stat-label {
    color: #888;
    font-size: 0.8rem;
}

.admin-actions {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 0.8rem;
    margin-bottom: 1.5rem;
}

/* Tag Management */
.tag-container {
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 1.5rem;
    margin-top: 1.5rem;
}

.tag-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.8rem;
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
}

.tag-name {
    font-weight: bold;
    color: var(--accent-color);
    padding: 0.2rem 0.6rem;
    border-radius: 2px;
    font-size: 0.85rem;
}

/* Alerts */
.alert-container {
    position: fixed;
    top: 15px;
    right: 15px;
    z-index: 9999;
}

.alert {
    padding: 0.8rem 1.5rem;
    margin-bottom: 0.8rem;
    border-radius: 2px;
    background: var(--table-row-alt);
    color: var(--accent-color);
    border: 1px solid var(--table-border);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    animation: slideIn 0.3s ease-out;
    font-size: 0.9rem;
}

.alert.error {
    border-color: #ff0000;
    color: #ff0000;
}

.alert.success {
    border-color: #00aa00;
    color: #00aa00;
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

/* Utility */
.text-center { text-align: center; }
.mt-2 { margin-top: 0.5rem; }
.mt-3 { margin-top: 0.8rem; }
.mt-4 { margin-top: 1.2rem; }
.mt-5 { margin-top: 1.5rem; }
.mb-2 { margin-bottom: 0.5rem; }
.mb-3 { margin-bottom: 0.8rem; }
.mb-4 { margin-bottom: 1.2rem; }
.mb-5 { margin-bottom: 1.5rem; }
.d-flex { display: flex; }
.justify-between { justify-content: space-between; }
.align-center { align-items: center; }
.gap-2 { gap: 0.5rem; }
.gap-3 { gap: 0.8rem; }

/* NEW: Paste creation form styling - DOXBIN STYLE */
.create-paste-container {
    max-width: 800px;
    margin: 0 auto;
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 1.5rem;
}

.create-paste-title {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    color: var(--accent-color);
    border-bottom: 1px solid var(--table-border);
    padding-bottom: 0.5rem;
}

.form-note {
    color: #888;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}

/* NEW: Human verification checkbox */
.verify-human-container {
    background: var(--table-header-bg);
    padding: 1rem;
    border: 1px solid var(--table-border);
    margin-bottom: 1.5rem;
    border-radius: 2px;
}

.verify-human-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent-color);
    font-size: 0.9rem;
    cursor: pointer;
}

.verify-human-checkbox {
    width: 16px;
    height: 16px;
}

/* NEW: Responsive tables */
@media (max-width: 768px) {
    .main-content { padding: 60px 1rem 1rem; }
    .menu-items { grid-template-columns: 1fr; }
    .paste-form, .auth-form { padding: 1.2rem; }
    .btn-group { flex-direction: column; }
    .paste-detail-content { padding: 1rem; }
    .paste-content { padding: 1rem; }
    
    .doxbin-table th, .doxbin-table td {
        padding: 0.6rem;
        font-size: 0.8rem;
    }
    
    .search-container {
        flex-direction: column;
        gap: 0.8rem;
    }
    
    .search-wrapper {
        width: 100%;
    }
    
    .pagination-container {
        flex-wrap: wrap;
        gap: 0.3rem;
    }
    
    .page-number, .pagination-btn {
        width: 32px;
        height: 32px;
        font-size: 0.8rem;
    }
    
    .share-link-container {
        flex-direction: column;
    }
}

/* NEW: Comments System Styles */
.comments-section {
    margin-top: 2rem;
    border-top: 1px solid var(--table-border);
    padding-top: 1.5rem;
}

.comment-form {
    background: var(--table-row-alt);
    padding: 1rem;
    border-radius: 2px;
    margin-bottom: 1.5rem;
}

.comment-form textarea {
    width: 100%;
    min-height: 80px;
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    color: var(--accent-color);
    padding: 0.8rem;
    border-radius: 2px;
    font-family: 'Arial', sans-serif;
    font-size: 0.9rem;
    resize: vertical;
    margin-bottom: 0.8rem;
}

.comment-form textarea:focus {
    outline: none;
    border-color: var(--link-color);
}

.comments-list {
    margin-top: 1.5rem;
}

.comment-item {
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 1rem;
    margin-bottom: 1rem;
}

.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.comment-author {
    font-weight: bold;
    color: var(--accent-color);
}

.comment-time {
    color: #888;
    font-size: 0.8rem;
}

.comment-content {
    white-space: pre-wrap;
    font-size: 0.9rem;
    line-height: 1.5;
}

.comment-actions {
    margin-top: 0.5rem;
    display: flex;
    gap: 0.5rem;
}

/* NEW: Raw Paste View Styles */
.raw-paste-view {
    background: var(--bg-color);
    border: 1px solid var(--table-border);
    padding: 1.5rem;
    border-radius: 2px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    overflow-x: auto;
    max-height: 500px;
    overflow-y: auto;
}

.raw-paste-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: var(--bg-color);
    z-index: 10001;
    padding: 15px;
    overflow-y: auto;
    display: none;
}

.raw-paste-container.active {
    display: block;
}

.raw-paste-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: rgba(10, 10, 10, 0.95);
    padding: 0.8rem 1.5rem;
    border-bottom: 1px solid var(--table-border);
    z-index: 10002;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 50px;
}

.raw-paste-content {
    margin-top: 60px;
    padding: 1.5rem;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

/* NEW: Profile Stats Styles */
.profile-stats {
    display: flex;
    gap: 2rem;
    margin: 1.5rem 0;
    padding: 1rem;
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--accent-color);
}

.stat-label {
    color: #888;
    font-size: 0.9rem;
    margin-top: 0.2rem;
}

/* NEW: Profile Page Layout */
.profile-header {
    display: flex;
    align-items: flex-end;
    margin-bottom: 2rem;
    position: relative;
    min-height: 200px;
}

.profile-header-banner {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-color: var(--bg-color);
}

.profile-header-content {
    position: relative;
    z-index: 2;
    display: flex;
    align-items: flex-end;
    width: 100%;
    padding: 1.5rem;
}

.profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 2px;
    border: 3px solid var(--table-border);
    background-color: var(--bg-color);
    background-size: cover;
    background-position: center;
    margin-right: 1.5rem;
}

.profile-info {
    flex: 1;
}

.profile-username {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.profile-badges {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

/* NEW: User Pastes Grid */
.user-pastes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
    margin-top: 1.5rem;
}

.user-paste-card {
    background: var(--table-row-alt);
    border: 1px solid var(--table-border);
    border-radius: 2px;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.3s;
}

.user-paste-card:hover {
    background: var(--hover-color);
    border-color: var(--link-color);
}

.user-paste-title {
    font-weight: bold;
    color: var(--accent-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.user-paste-meta {
    display: flex;
    justify-content: space-between;
    color: #888;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}
</style>
</head>
<body>
<!-- Timeout Overlay -->
<div id="timeout-overlay" class="timeout-overlay">
    <div class="timeout-message">YOU HAVE BEEN TIMED OUT</div>
    <div class="timeout-details" id="timeout-details"></div>
    <div style="color: #888; font-size: 0.9rem;">
        You will be redirected when the timeout expires
    </div>
</div>

<!-- Fullscreen Paste Detail -->
<div id="paste-detail-container" class="paste-detail-container">
    <div class="paste-detail-header">
        <button class="back-btn" onclick="closePasteDetail()">← Back to Pastes</button>
        <div id="paste-detail-actions"></div>
    </div>
    <div id="paste-detail-content" class="paste-detail-content"></div>
</div>

<!-- Raw Paste View -->
<div id="raw-paste-container" class="raw-paste-container">
    <div class="raw-paste-header">
        <button class="back-btn" onclick="closeRawPaste()">← Back to Paste</button>
        <button class="btn btn-primary" onclick="copyRawPaste()">Copy Raw</button>
    </div>
    <div id="raw-paste-content" class="raw-paste-content"></div>
</div>

<!-- Navigation -->
<nav class="navbar">
    <button class="hamburger-btn" onclick="toggleMenu()">☰</button>
    <div class="user-info">
        <span id="usernameDisplay" class="username-display"></span>
        <button class="btn btn-primary btn-small" onclick="showPage('auth')" id="authBtn">Sign In</button>
    </div>
</nav>

<!-- Slide Down Menu -->
<div class="slide-down-menu" id="slideDownMenu">
    <div class="menu-items">
        <button class="menu-btn" onclick="showPage('home')">Home</button>
        <button class="menu-btn" onclick="showPage('paste')">Create Paste</button>
        <button class="menu-btn" onclick="showPage('chat')">Global Chat</button>
        <button class="menu-btn" onclick="showPage('most-mentioned')">Most Mentioned</button>
        <button class="menu-btn" onclick="showPage('hall')">Hall of Autism</button>
        <button class="menu-btn hidden" id="myAccountBtn" onclick="showPage('myaccount')">My Account</button>
        <button class="menu-btn hidden" id="adminBtn" onclick="showPage('admin')">Admin Panel</button>
        <button class="menu-btn hidden" id="tagMakerBtn" onclick="showPage('tagMaker')">Tag Manager</button>
        <button class="menu-btn hidden" id="vipBtn" onclick="showPage('vip')">VIP Features</button>
    </div>
</div>

<!-- Main Content -->
<div class="main-content">
    <!-- Home Page -->
    <div id="home-page">
        <div class="logo-container">
            <img src="https://i.postimg.cc/x8ML5hVd/logo.jpg" alt="Norbin Logo" class="logo" onerror="this.onerror=null; this.src='https://via.placeholder.com/300x100/000000/ffffff?text=NORBIN+LOGO';">
        </div>

        <div class="search-container">
            <div class="search-wrapper">
                <input type="text"
                       class="search-bar"
                       id="searchBar"
                       placeholder="Search pastes by title, username, or content..."
                       onkeypress="if(event.key === 'Enter') performSearchNow()">
                <button class="search-btn" onclick="performSearchNow()">Search</button>
            </div>
        </div>

        <!-- Pinned Pastes -->
        <div id="pinned-pastes" class="pinned-pastes">
            <h2 class="section-title">Pinned Pastes</h2>
            <div id="pinned-pastes-container" class="pastes-table-container">
                <table class="doxbin-table" id="pinned-pastes-table">
                    <thead>
                        <tr>
                            <th width="40%">Title</th>
                            <th width="15%">Comments</th>
                            <th width="15%">Views</th>
                            <th width="15%">Created by</th>
                            <th width="15%">Added</th>
                        </tr>
                    </thead>
                    <tbody id="pinned-pastes-body">
                        <!-- Pinned pastes will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <h2 class="section-title">All Pastes</h2>
        <div id="pastes-container" class="pastes-table-container">
            <table class="doxbin-table" id="all-pastes-table">
                <thead>
                    <tr>
                        <th width="40%">Title</th>
                        <th width="15%">Comments</th>
                        <th width="15%">Views</th>
                        <th width="15%">Created by</th>
                        <th width="15%">Added</th>
                    </tr>
                </thead>
                <tbody id="all-pastes-body">
                    <!-- All pastes will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <!-- Pagination Container -->
        <div id="pagination-container" class="pagination-container hidden">
            <button class="pagination-btn" id="prev-page-btn" onclick="changePage(currentPage - 1)" disabled>←</button>
            
            <div class="pagination-pages" id="page-numbers">
                <!-- Page numbers will be dynamically generated here -->
            </div>
            
            <button class="pagination-btn" id="next-page-btn" onclick="changePage(currentPage + 1)" disabled>→</button>
        </div>
        
        <div id="pagination-info" class="pagination-info"></div>
    </div>

    <!-- Create Paste Page - DOXBIN STYLE -->
    <div id="paste-page" class="hidden">
        <div class="create-paste-container">
            <h2 class="create-paste-title">Create Paste</h2>
            
            <div class="paste-form">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="paste-title" placeholder="Enter paste title (no special characters)">
                    <div class="form-note">Maximum 100 characters</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <textarea class="form-textarea" id="paste-content" placeholder="Enter your paste content here..."></textarea>
                </div>
                
                <!-- Human Verification Checkbox -->
                <div class="verify-human-container">
                    <label class="verify-human-label">
                        <input type="checkbox" class="verify-human-checkbox" id="verify-human">
                        <span>Verify you are human</span>
                    </label>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="publishPaste()">Create Paste</button>
                    <button class="btn btn-secondary" onclick="clearPasteForm()">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Chat -->
    <div id="chat-page" class="hidden">
        <h2 class="section-title">Global Chat</h2>
        <div class="chat-container">
            <div class="chat-header">
                Live Global Chat • <span id="onlineCount">0</span> users online
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <input type="text"
                           class="chat-input"
                           id="chat-input"
                           placeholder="Type your message... (Press Enter to send)"
                           onkeypress="if(event.key === 'Enter') sendChatMessage()">
                    <button class="send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Most Mentioned -->
    <div id="most-mentioned-page" class="hidden">
        <h2 class="section-title">Most Mentioned Titles</h2>
        <div id="most-mentioned-container" class="pastes-grid"></div>
    </div>

    <!-- Hall of Autism -->
    <div id="hall-page" class="hidden">
        <h2 class="section-title">Hall of Autism</h2>
        <div class="hall-grid" id="hall-container"></div>
    </div>

    <!-- My Account -->
    <div id="myaccount-page" class="hidden">
        <h2 class="section-title">My Account</h2>
        <div class="profile-form">
            <div class="form-group">
                <div class="profile-banner">
                    <div id="profile-banner-img" class="profile-banner-img"></div>
                    <div class="profile-picture">
                        <div id="profile-picture-img" class="profile-picture-img"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-input" id="display-name" placeholder="Enter display name">
                    <button class="btn btn-primary mt-3" onclick="updateDisplayName()">Update Display Name</button>
                </div>

                <div class="form-group">
                    <label class="form-label">Banner Image URL</label>
                    <div class="url-input-group">
                        <input type="text" class="url-input" id="banner-url" placeholder="https://example.com/banner.jpg">
                        <button class="btn btn-primary" onclick="updateBanner()">Update</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Profile Picture URL</label>
                    <div class="url-input-group">
                        <input type="text" class="url-input" id="profile-url" placeholder="https://example.com/profile.jpg">
                        <button class="btn btn-primary" onclick="updateProfilePicture()">Update</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIP Features -->
    <div id="vip-page" class="hidden">
        <h2 class="section-title">VIP Features</h2>
        <div class="profile-form">
            <div class="form-group">
                <label class="form-label">Custom Username Color</label>
                <input type="color" class="form-input" id="username-color" value="#ffffff" style="height: 40px; padding: 0;">
                <button class="btn btn-gold mt-3" onclick="updateUsernameColor()">Update Color</button>
                <p class="mt-2" style="color: #888; font-size: 0.8rem;">
                    Note: VIP users can customize their username color. Glow effects are only for Owner and VIP roles.
                </p>
            </div>
        </div>
    </div>

    <!-- Tag Manager -->
    <div id="tagMaker-page" class="hidden">
        <h2 class="section-title">Tag Manager</h2>
        <div class="tag-form">
            <div class="form-group">
                <label class="form-label">Create New Tag</label>
                <input type="text" class="form-input" id="tag-name" placeholder="Enter tag name">
                <input type="color" class="form-input mt-2" id="tag-color" value="#ffffff" style="height: 40px; padding: 0;">
                <button class="btn btn-primary mt-3" onclick="createTag()">Create Tag</button>
            </div>
        </div>
        
        <div class="tag-container">
            <h3 class="section-title" style="font-size: 1.2rem;">Existing Tags</h3>
            <div id="tags-container">
                <!-- Tags will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-page" class="hidden">
        <h2 class="section-title">Admin Panel</h2>
        <div class="admin-controls">
            <div class="admin-title">Administrator Controls</div>

            <div class="admin-stats">
                <div class="stat-box">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="totalPastes">0</div>
                    <div class="stat-label">Total Pastes</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="bannedUsers">0</div>
                    <div class="stat-label">Banned Users</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="pinnedPastes">0</div>
                    <div class="stat-label">Pinned Pastes</div>
                </div>
            </div>

            <div class="admin-actions">
                <button class="btn btn-danger btn-small" onclick="adminViewAllUsers()">View All Users</button>
                <button class="btn btn-danger btn-small" onclick="adminViewAllPastes()">View All Pastes</button>
                <button class="btn btn-danger btn-small" onclick="adminClearChat()">Clear Chat</button>
                <button class="btn btn-danger btn-small" onclick="adminBackupData()">Backup Data</button>
                <button class="btn btn-danger btn-small" onclick="showTimeoutForm()">Timeout User</button>
                <button class="btn btn-danger btn-small" onclick="adminManageRoles()">Manage Roles</button>
            </div>

            <div id="admin-content" class="mt-4"></div>
            
            <!-- Timeout Form -->
            <div id="timeout-form" class="timeout-form hidden mt-4">
                <div class="admin-title">Timeout User</div>
                <div class="form-group">
                    <label class="form-label">User Email</label>
                    <input type="email" class="form-input" id="timeout-email" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Timeout Duration</label>
                    <div class="time-input-group">
                        <input type="number" class="form-input time-input" id="timeout-days" placeholder="Days" min="0">
                        <input type="number" class="form-input time-input" id="timeout-hours" placeholder="Hours" min="0" max="23">
                        <input type="number" class="form-input time-input" id="timeout-minutes" placeholder="Minutes" min="0" max="59">
                        <input type="number" class="form-input time-input" id="timeout-seconds" placeholder="Seconds" min="0" max="59">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-danger" onclick="adminTimeoutUser()">Timeout User</button>
                    <button class="btn btn-secondary" onclick="hideTimeoutForm()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Profile Page -->
    <div id="user-profile-page" class="hidden">
        <div class="profile-header">
            <div id="profile-banner" class="profile-header-banner"></div>
            <div class="profile-header-content">
                <div id="profile-avatar" class="profile-avatar"></div>
                <div class="profile-info">
                    <div id="profile-username" class="profile-username"></div>
                    <div id="profile-badges" class="profile-badges"></div>
                </div>
            </div>
        </div>

        <!-- Profile Stats -->
        <div class="profile-stats">
            <div class="stat-item">
                <div class="stat-value" id="paste-count">0</div>
                <div class="stat-label">Pastes</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="follows-count">0</div>
                <div class="stat-label">Followers</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="following-count">0</div>
                <div class="stat-label">Following</div>
            </div>
        </div>

        <!-- User's Pastes -->
        <h3 class="section-title">User's Pastes</h3>
        <div id="user-pastes-container" class="user-pastes-grid"></div>
    </div>

    <!-- Auth Page -->
    <div id="auth-page" class="hidden">
        <h2 class="section-title">Authentication</h2>
        <div class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="auth-email" placeholder="your@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <input type="password" class="form-input" id="auth-password" placeholder="••••••••">
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="signIn()">Sign In</button>
                <button class="btn btn-secondary" onclick="signUp()">Create Account</button>
            </div>
            <div id="auth-message" class="mt-3 text-center"></div>
        </div>
    </div>
</div>

<!-- Alert Container -->
<div id="alert-container" class="alert-container"></div>

<!-- Audio for Hall of Autism -->
<audio id="hallMusic" autoplay loop style="display: none;">
    <source src="https://jumpshare.com/share/TQW46hI41f8SrHjqZkva" type="audio/mpeg">
</audio>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration
const pasteDbConfig = {
    apiKey: "AIzaSyA1qaJnsRvWDvxNn9Nd1tmMVjvkF-WpUQY",
    authDomain: "norbin-c2fdb.firebaseapp.com",
    projectId: "norbin-c2fdb",
    storageBucket: "norbin-c2fdb.firebasestorage.app",
    messagingSenderId: "38678324468",
    appId: "1:38678324468:web:99301da909b4a563312aa1",
    measurementId: "G-XCBZJYZ2MJ"
};

const chatDbConfig = {
    apiKey: "AIzaSyByN2D1Q9IasxBI9qNostCzg13WbIFipUc",
    authDomain: "norbin-chat.firebaseapp.com",
    projectId: "norbin-chat",
    storageBucket: "norbin-chat.firebasestorage.app",
    messagingSenderId: "793931248044",
    appId: "1:793931248044:web:80a954c39e17efafd58a09",
    measurementId: "G-3TQ13WL0NV"
};

// Initialize Firebase Apps
const pasteApp = firebase.initializeApp(pasteDbConfig, "pasteApp");
const chatApp = firebase.initializeApp(chatDbConfig, "chatApp");

// Get Firebase Services
const pasteAuth = pasteApp.auth();
const pasteDb = pasteApp.firestore();
const chatDb = chatApp.firestore();

// Global State
let currentUser = null;
let userData = null;
let isAdmin = false;
let isManager = false;
let isVIP = false;
let isTagMaker = false;
let isOwner = false;
let searchTimeout = null;
let timeoutInterval = null;
let currentPasteId = null; // Track current paste for comments

// NEW: Pagination Variables
let currentPage = 1;
const itemsPerPage = 15; // Number of pastes per page
let totalPastes = 0;
let totalPages = 0;
let allPastesCache = []; // Cache for all pastes
let uniquePasteIds = new Set(); // To prevent duplicate pastes

// NEW: Comments System
let pasteComments = {}; // Store comments for each paste

// Alert System
function showAlert(message, type = 'info') {
    const container = document.getElementById('alert-container');
    const alert = document.createElement('div');
    alert.className = `alert ${type}`;
    alert.textContent = message;
    container.appendChild(alert);

    setTimeout(() => {
        alert.remove();
    }, 5000);
}

// NEW: Copy share link function
function copyShareLink(linkId) {
    const shareLinkInput = document.getElementById(`share-link-${linkId}`);
    const copyBtn = document.querySelector(`[onclick="copyShareLink('${linkId}')"]`);
    
    if (shareLinkInput) {
        shareLinkInput.select();
        shareLinkInput.setSelectionRange(0, 99999); // For mobile devices
        
        try {
            document.execCommand('copy');
            
            // Change button to show "Copied!" temporarily
            if (copyBtn) {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }
            
            showAlert('Link copied to clipboard!', 'success');
        } catch (err) {
            showAlert('Failed to copy link', 'error');
        }
    }
}

// NEW: Show raw paste
function showRawPaste(pasteId) {
    const container = document.getElementById('raw-paste-container');
    const contentContainer = document.getElementById('raw-paste-content');
    
    // Get the paste content
    const pasteElement = document.querySelector(`[data-paste-id="${pasteId}"]`);
    if (pasteElement) {
        const pasteContent = pasteElement.textContent;
        contentContainer.innerHTML = `<div class="raw-paste-view">${escapeHtml(pasteContent)}</div>`;
    } else {
        // Try to get from database
        loadPasteRawContent(pasteId);
    }
    
    container.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeRawPaste() {
    const container = document.getElementById('raw-paste-container');
    container.classList.remove('active');
    document.body.style.overflow = 'auto';
}

function copyRawPaste() {
    const rawContent = document.querySelector('.raw-paste-view');
    if (rawContent) {
        const textArea = document.createElement('textarea');
        textArea.value = rawContent.textContent;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showAlert('Raw paste copied to clipboard!', 'success');
    }
}

async function loadPasteRawContent(pasteId) {
    try {
        const doc = await pasteDb.collection('pastes').doc(pasteId).get();
        if (doc.exists) {
            const paste = doc.data();
            const contentContainer = document.getElementById('raw-paste-content');
            contentContainer.innerHTML = `<div class="raw-paste-view">${escapeHtml(paste.content)}</div>`;
        }
    } catch (error) {
        console.error('Error loading raw paste:', error);
    }
}

// NEW: Initialize Hall of Autism
function initializeHallOfAutism() {
    const hallContainer = document.getElementById('hall-container');
    hallContainer.innerHTML = '';

    const hallItems = [
        { name: "Mihai Caradan", description: "reasons:toxic, manipulationer, fakes that hes an kid with many non responsibilities that he said it for attention, mocks girls for the gayness that he is", image: "https://i.postimg.cc/ydG19g3W/image.png" },
        { name: "Azcox (david)", description: "reason:an wanna be discord drowner who thinks his opsec is good but he actually got full drowned by exotic slasher and void", image: "https://i.postimg.cc/3rp3jy1q/expoze1.jpg" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+3" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+4" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+5" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+6" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+7" },
        { name: "Noone", description: "Untitled", image: "https://via.placeholder.com/400x300/000000/ffffff?text=Image+8" }
    ];

    hallItems.forEach(item => {
        const box = document.createElement('div');
        box.className = 'hall-box';
        box.innerHTML = `
            <div class="hall-image">
                <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/400x300/000000/ffffff?text=Image+Error'">
            </div>
            <div class="hall-name">${item.name}</div>
            <div class="hall-description">${item.description}</div>
        `;
        hallContainer.appendChild(box);
    });

    // Auto-play music on Hall of Autism page
    if (!document.getElementById('hall-page').classList.contains('hidden')) {
        try {
            const hallMusic = document.getElementById('hallMusic');
            hallMusic.play().catch(e => {
                console.log("Music autoplay prevented");
            });
        } catch (e) {
            console.log("Music error:", e);
        }
    }
}

// NEW: Pagination Functions
function updatePaginationUI() {
    const paginationContainer = document.getElementById('pagination-container');
    const pageNumbersContainer = document.getElementById('page-numbers');
    const prevBtn = document.getElementById('prev-page-btn');
    const nextBtn = document.getElementById('next-page-btn');
    const paginationInfo = document.getElementById('pagination-info');
    
    // Update buttons state
    prevBtn.disabled = currentPage <= 1;
    nextBtn.disabled = currentPage >= totalPages;
    
    // Generate page numbers
    pageNumbersContainer.innerHTML = '';
    
    // Always show first page
    createPageNumber(1);
    
    // Calculate range to show
    let startPage = Math.max(2, currentPage - 1);
    let endPage = Math.min(totalPages - 1, currentPage + 1);
    
    // Add ellipsis after first page if needed
    if (startPage > 2) {
        pageNumbersContainer.innerHTML += '<span class="page-ellipsis">...</span>';
    }
    
    // Add middle pages
    for (let i = startPage; i <= endPage; i++) {
        createPageNumber(i);
    }
    
    // Add ellipsis before last page if needed
    if (endPage < totalPages - 1) {
        pageNumbersContainer.innerHTML += '<span class="page-ellipsis">...</span>';
    }
    
    // Always show last page if there is more than one page
    if (totalPages > 1) {
        createPageNumber(totalPages);
    }
    
    // Update pagination info
    const startItem = ((currentPage - 1) * itemsPerPage) + 1;
    const endItem = Math.min(currentPage * itemsPerPage, totalPastes);
    paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${totalPastes} pastes`;
    
    // Show/hide pagination container
    if (totalPages > 1) {
        paginationContainer.classList.remove('hidden');
    } else {
        paginationContainer.classList.add('hidden');
    }
}

function createPageNumber(pageNum) {
    const pageNumbersContainer = document.getElementById('page-numbers');
    const pageBtn = document.createElement('button');
    pageBtn.className = `page-number ${pageNum === currentPage ? 'active' : ''}`;
    pageBtn.textContent = pageNum;
    pageBtn.onclick = () => changePage(pageNum);
    pageNumbersContainer.appendChild(pageBtn);
}

function changePage(pageNum) {
    if (pageNum < 1 || pageNum > totalPages || pageNum === currentPage) {
        return;
    }
    
    currentPage = pageNum;
    displayPaginationPastes();
    updatePaginationUI();
    
    // Scroll to top of pastes container
    document.getElementById('pastes-container').scrollIntoView({ behavior: 'smooth' });
}

async function displayPaginationPastes() {
    try {
        // Calculate start and end indices
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        
        // Get pastes for current page
        const pagePastes = allPastesCache.slice(startIndex, endIndex);
        
        // Display the pastes in Doxbin style
        const container = document.getElementById('all-pastes-body');
        container.innerHTML = '';
        
        if (pagePastes.length === 0) {
            container.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">No pastes found.</td></tr>';
            return;
        }
        
        // Clear unique IDs set for this page
        const pageUniqueIds = new Set();
        
        pagePastes.forEach(paste => {
            // Skip duplicates within the same page
            if (pageUniqueIds.has(paste.id)) return;
            pageUniqueIds.add(paste.id);
            
            const row = document.createElement('tr');
            
            // Create title with clickable link
            const titleCell = document.createElement('td');
            const titleLink = document.createElement('a');
            titleLink.href = 'javascript:void(0)';
            titleLink.className = 'paste-title-link';
            titleLink.textContent = paste.title;
            titleLink.onclick = () => showPasteDetail(paste.id);
            titleCell.appendChild(titleLink);
            if (paste.isPinned) {
                const pinnedBadge = document.createElement('span');
                pinnedBadge.className = 'badge badge-pinned';
                pinnedBadge.textContent = 'PINNED';
                titleCell.appendChild(pinnedBadge);
            }
            
            // Comments cell
            const commentsCell = document.createElement('td');
            const commentsSpan = document.createElement('span');
            commentsSpan.className = 'comments-count';
            commentsSpan.textContent = paste.commentCount || 0;
            commentsSpan.onclick = () => showPasteDetail(paste.id);
            commentsSpan.style.cursor = 'pointer';
            commentsCell.appendChild(commentsSpan);
            
            // Views cell
            const viewsCell = document.createElement('td');
            const viewsSpan = document.createElement('span');
            viewsSpan.className = 'views-count';
            viewsSpan.textContent = paste.views || 0;
            viewsSpan.onclick = () => showPasteDetail(paste.id);
            viewsSpan.style.cursor = 'pointer';
            viewsCell.appendChild(viewsSpan);
            
            // Created by cell
            const userCell = document.createElement('td');
            const userLink = document.createElement('a');
            userLink.href = 'javascript:void(0)';
            userLink.className = 'paste-link';
            userLink.textContent = paste.username || 'Anonymous';
            userLink.onclick = () => showUserProfile(paste.userId);
            userCell.appendChild(userLink);
            
            // Add badges for special users
            if (paste.userRole === 'manager') {
                const badge = document.createElement('span');
                badge.className = 'badge badge-manager';
                badge.textContent = 'Manager';
                userCell.appendChild(badge);
            } else if (paste.userRole === 'admin') {
                const badge = document.createElement('span');
                badge.className = 'badge badge-admin';
                badge.textContent = 'Admin';
                userCell.appendChild(badge);
            } else if (paste.userRole === 'vip') {
                const badge = document.createElement('span');
                badge.className = 'badge badge-vip';
                badge.textContent = 'VIP';
                userCell.appendChild(badge);
            } else if (paste.userRole === 'owner') {
                const badge = document.createElement('span');
                badge.className = 'badge badge-owner';
                badge.textContent = 'Owner';
                userCell.appendChild(badge);
            }
            
            // Added date cell
            const dateCell = document.createElement('td');
            dateCell.textContent = formatTime(paste.timestamp?.toDate());
            
            // Append all cells to row
            row.appendChild(titleCell);
            row.appendChild(commentsCell);
            row.appendChild(viewsCell);
            row.appendChild(userCell);
            row.appendChild(dateCell);
            
            container.appendChild(row);
        });
    } catch (error) {
        console.error('Error displaying paginated pastes:', error);
    }
}

async function loadPaginationData() {
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .get();
        
        // Clear cache and unique IDs
        allPastesCache = [];
        uniquePasteIds.clear();
        
        // Get user data for each paste
        for (const doc of snapshot.docs) {
            const paste = doc.data();
            const pasteId = doc.id;
            
            // Skip duplicates across entire dataset
            if (uniquePasteIds.has(pasteId)) continue;
            uniquePasteIds.add(pasteId);
            
            // Get user role
            let userRole = 'user';
            try {
                const userDoc = await pasteDb.collection('users').doc(paste.userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    if (userData.isOwner) userRole = 'owner';
                    else if (userData.isAdmin) userRole = 'admin';
                    else if (userData.isManager) userRole = 'manager';
                    else if (userData.isVIP) userRole = 'vip';
                }
            } catch (error) {
                console.error('Error getting user role:', error);
            }
            
            // Get comment count
            let commentCount = 0;
            try {
                const commentsSnapshot = await pasteDb.collection('comments')
                    .where('pasteId', '==', pasteId)
                    .where('isRemoved', '==', false)
                    .get();
                commentCount = commentsSnapshot.size;
            } catch (error) {
                // Comments collection might not exist yet
                commentCount = 0;
            }
            
            allPastesCache.push({ 
                id: pasteId, 
                ...paste,
                userRole: userRole,
                commentCount: commentCount
            });
        }
        
        // Sort by timestamp to ensure proper order
        allPastesCache.sort((a, b) => {
            const timeA = a.timestamp?.toDate?.() || new Date(0);
            const timeB = b.timestamp?.toDate?.() || new Date(0);
            return timeB - timeA;
        });
        
        // Update totals
        totalPastes = allPastesCache.length;
        totalPages = Math.ceil(totalPastes / itemsPerPage);
        
        // Reset to first page
        currentPage = 1;
        
        // Update UI
        displayPaginationPastes();
        updatePaginationUI();
        
    } catch (error) {
        console.error('Error loading pagination data:', error);
        document.getElementById('all-pastes-body').innerHTML = 
            '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">Error loading pastes.</td></tr>';
    }
}

// Menu Functions
function toggleMenu() {
    const menu = document.getElementById('slideDownMenu');
    menu.classList.toggle('active');
}

function showPage(pageId) {
    // Close menu
    document.getElementById('slideDownMenu').classList.remove('active');
    
    // Hide all pages
    document.querySelectorAll('[id$="-page"]').forEach(page => {
        page.classList.add('hidden');
    });
    
    // Show requested page
    const page = document.getElementById(pageId + '-page');
    if (page) {
        page.classList.remove('hidden');
        
        // Load data for specific pages
        switch(pageId) {
            case 'home':
                loadRecentPastes();
                loadPinnedPastes();
                loadPaginationData();
                break;
            case 'chat':
                loadChatMessages();
                break;
            case 'most-mentioned':
                loadMostMentioned();
                break;
            case 'hall':
                initializeHallOfAutism();
                break;
            case 'myaccount':
                loadUserProfileData();
                break;
            case 'vip':
                loadVIPFeatures();
                break;
            case 'tagMaker':
                loadTags();
                break;
            case 'admin':
                loadAdminStats();
                break;
        }
    }
}

// Search Functions
function handleSearch() {
    const searchTerm = document.getElementById('searchBar').value.trim();
    
    if (searchTerm.length === 0) {
        loadPaginationData();
        return;
    }
    
    if (searchTimeout) clearTimeout(searchTimeout);
    
    searchTimeout = setTimeout(() => {
        performSearch(searchTerm);
    }, 300);
}

function performSearchNow() {
    const searchTerm = document.getElementById('searchBar').value.trim();
    if (searchTerm) {
        performSearch(searchTerm);
    } else {
        loadPaginationData();
    }
}

async function performSearch(searchTerm) {
    try {
        // Hide pagination during search
        document.getElementById('pagination-container').classList.add('hidden');
        
        const snapshot = await pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .get();
        
        const results = [];
        const searchLower = searchTerm.toLowerCase();
        const uniqueIds = new Set();
        
        snapshot.forEach(doc => {
            const paste = doc.data();
            const pasteId = doc.id;
            
            // Skip duplicates
            if (uniqueIds.has(pasteId)) return;
            uniqueIds.add(pasteId);
            
            const titleMatch = paste.title.toLowerCase().includes(searchLower);
            const contentMatch = paste.content.toLowerCase().includes(searchLower);
            const userMatch = (paste.username || '').toLowerCase().includes(searchLower);
            
            if (titleMatch || contentMatch || userMatch) {
                results.push({ id: pasteId, ...paste });
            }
        });
        
        displaySearchResults(results);
    } catch (error) {
        console.error('Error searching:', error);
        showAlert('Error searching pastes', 'error');
    }
}

// NEW: FULLSCREEN PASTE DETAIL with Share Link and Comments
function showPasteDetail(pasteId) {
    const container = document.getElementById('paste-detail-container');
    container.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    currentPasteId = pasteId; // Set current paste for comments
    loadPasteDetailContent(pasteId);
}

function closePasteDetail() {
    const container = document.getElementById('paste-detail-container');
    container.classList.remove('active');
    document.body.style.overflow = 'auto';
    currentPasteId = null; // Clear current paste
}

async function loadPasteDetailContent(pasteId) {
    try {
        // Increment view count
        await pasteDb.collection('pastes').doc(pasteId).update({
            views: firebase.firestore.FieldValue.increment(1)
        });
        
        const doc = await pasteDb.collection('pastes').doc(pasteId).get();
        const paste = doc.data();
        const container = document.getElementById('paste-detail-content');
        const actionsContainer = document.getElementById('paste-detail-actions');
        
        let adminControls = '';
        if (isAdmin || isManager || isOwner) {
            adminControls = `
                <div class="btn-group">
                    <button class="btn btn-success" onclick="adminPinPaste('${pasteId}', true)">
                        Pin to Pinned
                    </button>
                    ${paste.isPinned ? `<button class="btn btn-warning" onclick="adminPinPaste('${pasteId}', false)">
                        Remove from Pinned
                    </button>` : ''}
                    <button class="btn btn-danger" onclick="adminRemovePaste('${pasteId}')">
                        Remove Paste
                    </button>
                    ${(isAdmin || isManager || isOwner) ? `<button class="btn btn-danger" onclick="adminBanUser('${paste.userId}')">
                        Ban User
                    </button>` : ''}
                    ${(isAdmin || isOwner) ? `<button class="btn btn-danger" onclick="showTimeoutUserForm('${paste.userId}')">
                        Timeout User
                    </button>` : ''}
                </div>
            `;
        }
        
        actionsContainer.innerHTML = adminControls;
        
        // Generate shareable link
        const baseUrl = window.location.origin + window.location.pathname;
        const shareLink = `${baseUrl}?paste=${pasteId}`;
        
        // Get user role for badge
        let userRoleBadge = '';
        try {
            const userDoc = await pasteDb.collection('users').doc(paste.userId).get();
            if (userDoc.exists) {
                const userData = userDoc.data();
                if (userData.isOwner) userRoleBadge = '<span class="badge badge-owner">Owner</span>';
                else if (userData.isAdmin) userRoleBadge = '<span class="badge badge-admin">Admin</span>';
                else if (userData.isManager) userRoleBadge = '<span class="badge badge-manager">Manager</span>';
                else if (userData.isVIP) userRoleBadge = '<span class="badge badge-vip">VIP</span>';
            }
        } catch (error) {
            console.error('Error getting user role:', error);
        }
        
        // Get comment count
        let commentCount = 0;
        try {
            const commentsSnapshot = await pasteDb.collection('comments')
                .where('pasteId', '==', pasteId)
                .where('isRemoved', '==', false)
                .get();
            commentCount = commentsSnapshot.size;
        } catch (error) {
            commentCount = 0;
        }
        
        container.innerHTML = `
            <div style="margin-bottom: 1.5rem;">
                <a href="javascript:void(0)" class="paste-link" onclick="showUserProfile('${paste.userId}')">
                    ${escapeHtml(paste.username || 'Anonymous')}
                </a>
                ${userRoleBadge}
                ${paste.isPinned ? '<span class="badge badge-pinned">PINNED</span>' : ''}
            </div>
            
            <h1 style="color: var(--accent-color); margin-bottom: 1rem; font-size: 1.8rem;">
                ${escapeHtml(paste.title)}
            </h1>
            
            <div style="color: #888; margin-bottom: 1.5rem; font-size: 0.9rem;">
                <span style="margin-right: 1rem;" class="views-count" onclick="showPasteDetail('${pasteId}')" style="cursor: pointer;">${paste.views || 0} views</span>
                <span style="margin-right: 1rem;" class="comments-count" onclick="scrollToComments()" style="cursor: pointer;">${commentCount} comments</span>
                <span style="margin-right: 1rem;">${formatTime(paste.timestamp?.toDate())}</span>
            </div>
            
            <!-- Action Buttons -->
            <div class="btn-group mb-3">
                <button class="btn btn-primary" onclick="showRawPaste('${pasteId}')">View Full Paste Raw</button>
                <button class="btn btn-secondary" onclick="scrollToComments()">View Comments</button>
            </div>
            
            <!-- Share Link Section -->
            <div class="share-section">
                <h3 style="font-size: 1rem; margin-bottom: 0.5rem; color: var(--accent-color);">Share this paste:</h3>
                <div class="share-link-container">
                    <input type="text" class="share-link" value="${shareLink}" readonly id="share-link-${pasteId}">
                    <button class="copy-btn" onclick="copyShareLink('${pasteId}')">Copy Link</button>
                </div>
            </div>
            
            <div class="paste-content" data-paste-id="${pasteId}">${escapeHtml(paste.content)}</div>
            
            <!-- Comments Section -->
            <div id="comments-section" class="comments-section">
                <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: var(--accent-color);">Comments (${commentCount})</h3>
                
                <!-- Comment Form -->
                ${currentUser ? `
                <div class="comment-form">
                    <textarea id="comment-input" placeholder="Add a comment..."></textarea>
                    <button class="btn btn-primary" onclick="postComment('${pasteId}')">Post Comment</button>
                </div>
                ` : `
                <div style="text-align: center; padding: 1rem; background: var(--table-row-alt); border-radius: 2px;">
                    <a href="javascript:void(0)" onclick="showPage('auth')" style="color: var(--link-color); text-decoration: none;">
                        Sign in to comment
                    </a>
                </div>
                `}
                
                <!-- Comments List -->
                <div id="comments-list" class="comments-list"></div>
            </div>
        `;
        
        // Load comments
        loadComments(pasteId);
    } catch (error) {
        showAlert(`Error loading paste: ${error.message}`, 'error');
        closePasteDetail();
    }
}

function scrollToComments() {
    const commentsSection = document.getElementById('comments-section');
    if (commentsSection) {
        commentsSection.scrollIntoView({ behavior: 'smooth' });
    }
}

// NEW: Comments System Functions
async function loadComments(pasteId) {
    try {
        const commentsList = document.getElementById('comments-list');
        if (!commentsList) return;
        
        commentsList.innerHTML = '<div style="text-align: center; padding: 1rem; color: #888;">Loading comments...</div>';
        
        const snapshot = await pasteDb.collection('comments')
            .where('pasteId', '==', pasteId)
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .get();
        
        commentsList.innerHTML = '';
        
        if (snapshot.empty) {
            commentsList.innerHTML = '<div style="text-align: center; padding: 1rem; color: #888;">No comments yet. Be the first to comment!</div>';
            return;
        }
        
        snapshot.forEach(async (doc) => {
            const comment = doc.data();
            const commentId = doc.id;
            
            // Get user data
            let username = 'Anonymous';
            let userRole = 'user';
            let userColor = '#ffffff';
            
            try {
                const userDoc = await pasteDb.collection('users').doc(comment.userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    username = userData.displayName || userData.username || 'Anonymous';
                    userColor = userData.usernameColor || '#ffffff';
                    
                    if (userData.isOwner) userRole = 'owner';
                    else if (userData.isAdmin) userRole = 'admin';
                    else if (userData.isManager) userRole = 'manager';
                    else if (userData.isVIP) userRole = 'vip';
                }
            } catch (error) {
                console.error('Error getting user data:', error);
            }
            
            // Create comment element
            const commentElement = document.createElement('div');
            commentElement.className = 'comment-item';
            commentElement.id = `comment-${commentId}`;
            
            let roleBadge = '';
            if (userRole === 'owner') roleBadge = '<span class="badge badge-owner">Owner</span>';
            else if (userRole === 'admin') roleBadge = '<span class="badge badge-admin">Admin</span>';
            else if (userRole === 'manager') roleBadge = '<span class="badge badge-manager">Manager</span>';
            else if (userRole === 'vip') roleBadge = '<span class="badge badge-vip">VIP</span>';
            
            let deleteButton = '';
            if ((currentUser && (currentUser.uid === comment.userId)) || isAdmin || isManager || isOwner) {
                deleteButton = `<button class="btn btn-danger btn-small" onclick="deleteComment('${commentId}')">Delete</button>`;
            }
            
            commentElement.innerHTML = `
                <div class="comment-header">
                    <div class="comment-author" style="color: ${userColor}">
                        ${escapeHtml(username)}
                        ${roleBadge}
                    </div>
                    <div class="comment-time">${formatTime(comment.timestamp?.toDate())}</div>
                </div>
                <div class="comment-content">${escapeHtml(comment.content)}</div>
                <div class="comment-actions">
                    ${deleteButton}
                </div>
            `;
            
            commentsList.appendChild(commentElement);
        });
    } catch (error) {
        console.error('Error loading comments:', error);
        const commentsList = document.getElementById('comments-list');
        if (commentsList) {
            commentsList.innerHTML = '<div style="text-align: center; padding: 1rem; color: #ff0000;">Error loading comments</div>';
        }
    }
}

async function postComment(pasteId) {
    if (!currentUser) {
        showAlert('Please sign in to comment', 'error');
        showPage('auth');
        return;
    }
    
    const commentInput = document.getElementById('comment-input');
    const content = commentInput.value.trim();
    
    if (!content) {
        showAlert('Please enter a comment', 'error');
        return;
    }
    
    try {
        await pasteDb.collection('comments').add({
            pasteId: pasteId,
            userId: currentUser.uid,
            content: content,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            isRemoved: false
        });
        
        commentInput.value = '';
        showAlert('Comment posted successfully!', 'success');
        
        // Reload comments
        loadComments(pasteId);
        
        // Update comment count in paste detail
        updateCommentCount(pasteId);
        
    } catch (error) {
        showAlert(`Error posting comment: ${error.message}`, 'error');
    }
}

async function deleteComment(commentId) {
    if (!currentUser) return;
    
    if (confirm('Are you sure you want to delete this comment?')) {
        try {
            const commentDoc = await pasteDb.collection('comments').doc(commentId).get();
            const comment = commentDoc.data();
            
            // Check if user has permission to delete
            if (currentUser.uid !== comment.userId && !isAdmin && !isManager && !isOwner) {
                showAlert('You do not have permission to delete this comment', 'error');
                return;
            }
            
            // Soft delete by marking as removed
            await pasteDb.collection('comments').doc(commentId).update({
                isRemoved: true
            });
            
            showAlert('Comment deleted', 'success');
            
            // Remove from UI
            const commentElement = document.getElementById(`comment-${commentId}`);
            if (commentElement) {
                commentElement.remove();
            }
            
            // Update comment count
            if (comment.pasteId) {
                updateCommentCount(comment.pasteId);
            }
            
        } catch (error) {
            showAlert(`Error deleting comment: ${error.message}`, 'error');
        }
    }
}

async function updateCommentCount(pasteId) {
    try {
        const commentsSnapshot = await pasteDb.collection('comments')
            .where('pasteId', '==', pasteId)
            .where('isRemoved', '==', false)
            .get();
        
        const commentCount = commentsSnapshot.size;
        
        // Update comment count in UI
        const commentCountElement = document.querySelector('.comments-count');
        if (commentCountElement) {
            commentCountElement.textContent = `${commentCount} comments`;
        }
        
        // Update in cache
        const pasteIndex = allPastesCache.findIndex(p => p.id === pasteId);
        if (pasteIndex !== -1) {
            allPastesCache[pasteIndex].commentCount = commentCount;
        }
        
    } catch (error) {
        console.error('Error updating comment count:', error);
    }
}

// Authentication
async function signIn() {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    
    if (!email || !password) {
        showAlert('Please enter both email and password', 'error');
        return;
    }
    
    try {
        const userCredential = await pasteAuth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        await checkUserStatus();
        updateUIForAuth();
        showAlert('Successfully signed in!', 'success');
        showPage('home');
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function signUp() {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    
    if (!email || !password) {
        showAlert('Please enter both email and password', 'error');
        return;
    }
    
    if (password.length < 6) {
        showAlert('Password must be at least 6 characters', 'error');
        return;
    }
    
    try {
        const userCredential = await pasteAuth.createUserWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        
        // Check if user should be owner (based on email)
        const ownerEmail = 'exoticslash3r@gmail.com';
        const isOwnerEmail = email === ownerEmail;
        
        // Create user profile with follow system
        const userData = {
            email: email,
            username: email.split('@')[0],
            displayName: email.split('@')[0],
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            isBanned: false,
            isAdmin: isOwnerEmail,
            isManager: false,
            isVIP: false,
            isTagMaker: false,
            isOwner: isOwnerEmail,
            usernameColor: '#ffffff',
            bannerUrl: '',
            profileUrl: '',
            lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
            timeoutUntil: null,
            followers: [], // Array of user IDs who follow this user
            following: [], // Array of user IDs this user follows
            pasteCount: 0 // Track number of pastes
        };
        
        await pasteDb.collection('users').doc(currentUser.uid).set(userData);
        
        await checkUserStatus();
        updateUIForAuth();
        showAlert('Account created successfully!', 'success');
        showPage('home');
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

function signOut() {
    pasteAuth.signOut().then(() => {
        currentUser = null;
        userData = null;
        isAdmin = false;
        isManager = false;
        isVIP = false;
        isTagMaker = false;
        isOwner = false;
        updateUIForAuth();
        showAlert('Signed out successfully', 'success');
        showPage('home');
    });
}

async function checkUserStatus() {
    if (!currentUser) {
        resetUserStatus();
        return;
    }
    
    try {
        const userDoc = await pasteDb.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
            userData = userDoc.data();
            
            // Check for timeout
            if (userData.timeoutUntil) {
                const timeoutUntil = userData.timeoutUntil.toDate();
                if (timeoutUntil > new Date()) {
                    showTimeoutNotification(timeoutUntil);
                    return;
                } else {
                    // Clear timeout if expired
                    await pasteDb.collection('users').doc(currentUser.uid).update({
                        timeoutUntil: null
                    });
                }
            }
            
            // Set role flags
            isAdmin = userData.isAdmin || false;
            isManager = userData.isManager || false;
            isVIP = userData.isVIP || false;
            isTagMaker = userData.isTagMaker || false;
            isOwner = userData.isOwner || false;
            
            // Owner has all permissions
            if (isOwner) {
                isAdmin = true;
                isManager = true;
                isVIP = true;
                isTagMaker = true;
            }
            
            // Update admin status if owner email
            if (currentUser.email === 'exoticslash3r@gmail.com' && !userData.isOwner) {
                await pasteDb.collection('users').doc(currentUser.uid).update({
                    isOwner: true,
                    isAdmin: true,
                    isManager: true,
                    isVIP: true,
                    isTagMaker: true
                });
                isOwner = true;
                isAdmin = true;
                isManager = true;
                isVIP = true;
                isTagMaker = true;
            }
        } else {
            // Create user document if it doesn't exist
            const isOwnerEmail = currentUser.email === 'exoticslash3r@gmail.com';
            userData = {
                email: currentUser.email,
                username: currentUser.email.split('@')[0],
                displayName: currentUser.email.split('@')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                isBanned: false,
                isAdmin: isOwnerEmail,
                isManager: false,
                isVIP: false,
                isTagMaker: false,
                isOwner: isOwnerEmail,
                usernameColor: '#ffffff',
                bannerUrl: '',
                profileUrl: '',
                lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                timeoutUntil: null,
                followers: [],
                following: [],
                pasteCount: 0
            };
            await pasteDb.collection('users').doc(currentUser.uid).set(userData);
            
            isOwner = isOwnerEmail;
            isAdmin = isOwnerEmail;
            isManager = isOwnerEmail;
            isVIP = isOwnerEmail;
            isTagMaker = isOwnerEmail;
        }
    } catch (error) {
        console.error('Error checking user status:', error);
        resetUserStatus();
    }
}

function resetUserStatus() {
    isAdmin = false;
    isManager = false;
    isVIP = false;
    isTagMaker = false;
    isOwner = false;
    userData = null;
}

function updateUIForAuth() {
    const authBtn = document.getElementById('authBtn');
    const myAccountBtn = document.getElementById('myAccountBtn');
    const adminBtn = document.getElementById('adminBtn');
    const vipBtn = document.getElementById('vipBtn');
    const tagMakerBtn = document.getElementById('tagMakerBtn');
    const usernameDisplay = document.getElementById('usernameDisplay');
    
    if (currentUser && userData) {
        authBtn.textContent = 'Sign Out';
        authBtn.onclick = signOut;
        myAccountBtn.classList.remove('hidden');
        
        // Set username with appropriate styling
        const displayName = userData.displayName || userData.username || currentUser.email.split('@')[0];
        usernameDisplay.textContent = displayName;
        usernameDisplay.style.color = userData.usernameColor || '#ffffff';
        
        if (isOwner) {
            usernameDisplay.className = 'username-display owner-glow';
        } else if (isVIP) {
            usernameDisplay.className = 'username-display vip-glow';
        } else {
            usernameDisplay.className = 'username-display';
        }
        
        // Show/hide admin button
        if (isAdmin || isManager || isOwner) {
            adminBtn.classList.remove('hidden');
        } else {
            adminBtn.classList.add('hidden');
        }
        
        // Show/hide VIP button
        if (isVIP || isOwner) {
            vipBtn.classList.remove('hidden');
        } else {
            vipBtn.classList.add('hidden');
        }
        
        // Show/hide tag maker button
        if (isTagMaker || isOwner || isManager || isAdmin) {
            tagMakerBtn.classList.remove('hidden');
        } else {
            tagMakerBtn.classList.add('hidden');
        }
        
        if (isOwner) {
            showAlert('OWNER privileges activated!', 'success');
        } else if (isAdmin) {
            showAlert('Admin privileges activated!', 'success');
        } else if (isManager) {
            showAlert('Manager privileges activated!', 'success');
        } else if (isVIP) {
            showAlert('VIP privileges activated!', 'success');
        }
    } else {
        authBtn.textContent = 'Sign In';
        authBtn.onclick = () => showPage('auth');
        myAccountBtn.classList.add('hidden');
        adminBtn.classList.add('hidden');
        vipBtn.classList.add('hidden');
        tagMakerBtn.classList.add('hidden');
        usernameDisplay.textContent = '';
        usernameDisplay.className = 'username-display';
    }
}

// Paste Management
async function publishPaste() {
    if (!currentUser) {
        showAlert('Please sign in to publish pastes', 'error');
        showPage('auth');
        return;
    }
    
    // Check if human verification is checked
    const verifyCheckbox = document.getElementById('verify-human');
    if (!verifyCheckbox || !verifyCheckbox.checked) {
        showAlert('Please verify you are human', 'error');
        return;
    }
    
    const title = document.getElementById('paste-title').value.trim();
    const content = document.getElementById('paste-content').value.trim();
    
    if (!title || !content) {
        showAlert('Please fill in both title and content', 'error');
        return;
    }
    
    if (title.length > 100) {
        showAlert('Title must be 100 characters or less', 'error');
        return;
    }
    
    try {
        const pasteData = {
            title: title,
            content: content,
            username: userData.displayName || userData.username || currentUser.email.split('@')[0],
            userId: currentUser.uid,
            views: 0,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            isPinned: false,
            isRemoved: false,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await pasteDb.collection('pastes').add(pasteData);
        
        // Update user's paste count
        await pasteDb.collection('users').doc(currentUser.uid).update({
            pasteCount: firebase.firestore.FieldValue.increment(1)
        });
        
        showAlert('Paste published successfully!', 'success');
        clearPasteForm();
        showPage('home');
        loadPaginationData(); // Reload the pagination
    } catch (error) {
        showAlert(`Error publishing paste: ${error.message}`, 'error');
    }
}

function clearPasteForm() {
    document.getElementById('paste-title').value = '';
    document.getElementById('paste-content').value = '';
    const verifyCheckbox = document.getElementById('verify-human');
    if (verifyCheckbox) verifyCheckbox.checked = false;
}

// Remove old loadRecentPastes function and replace with pagination version
async function loadRecentPastes() {
    // This function is now handled by loadPaginationData
    loadPaginationData();
}

async function loadPinnedPastes() {
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('isPinned', '==', true)
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .get();
        
        displayPastesTable(snapshot, 'pinned-pastes-body', true);
    } catch (error) {
        console.error('Error loading pinned pastes:', error);
        document.getElementById('pinned-pastes-body').innerHTML = 
            '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">No pinned pastes yet.</td></tr>';
    }
}

function displayPastesTable(snapshot, containerId, isPinned = false) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    
    if (snapshot.empty) {
        if (isPinned) {
            container.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">No pinned pastes yet.</td></tr>';
        } else {
            container.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">No pastes found.</td></tr>';
        }
        return;
    }
    
    const uniqueIds = new Set();
    
    snapshot.forEach(doc => {
        const paste = doc.data();
        const pasteId = doc.id;
        
        // Skip duplicates
        if (uniqueIds.has(pasteId)) return;
        uniqueIds.add(pasteId);
        
        const row = document.createElement('tr');
        
        // Title cell with clickable link
        const titleCell = document.createElement('td');
        const titleLink = document.createElement('a');
        titleLink.href = 'javascript:void(0)';
        titleLink.className = 'paste-title-link';
        titleLink.textContent = paste.title;
        titleLink.onclick = () => showPasteDetail(pasteId);
        titleCell.appendChild(titleLink);
        
        if (isPinned) {
            const pinnedBadge = document.createElement('span');
            pinnedBadge.className = 'badge badge-pinned';
            pinnedBadge.textContent = 'PINNED';
            titleCell.appendChild(pinnedBadge);
        }
        
        // Comments cell
        const commentsCell = document.createElement('td');
        const commentsSpan = document.createElement('span');
        commentsSpan.className = 'comments-count';
        commentsSpan.textContent = paste.commentCount || '0';
        commentsSpan.onclick = () => showPasteDetail(pasteId);
        commentsSpan.style.cursor = 'pointer';
        commentsCell.appendChild(commentsSpan);
        
        // Views cell
        const viewsCell = document.createElement('td');
        const viewsSpan = document.createElement('span');
        viewsSpan.className = 'views-count';
        viewsSpan.textContent = paste.views || 0;
        viewsSpan.onclick = () => showPasteDetail(pasteId);
        viewsSpan.style.cursor = 'pointer';
        viewsCell.appendChild(viewsSpan);
        
        // Created by cell
        const userCell = document.createElement('td');
        const userLink = document.createElement('a');
        userLink.href = 'javascript:void(0)';
        userLink.className = 'paste-link';
        userLink.textContent = paste.username || 'Anonymous';
        userLink.onclick = () => showUserProfile(paste.userId);
        userCell.appendChild(userLink);
        
        // Added date cell
        const dateCell = document.createElement('td');
        dateCell.textContent = formatTime(paste.timestamp?.toDate());
        
        // Append all cells to row
        row.appendChild(titleCell);
        row.appendChild(commentsCell);
        row.appendChild(viewsCell);
        row.appendChild(userCell);
        row.appendChild(dateCell);
        
        container.appendChild(row);
    });
}

function displaySearchResults(results) {
    const container = document.getElementById('all-pastes-body');
    container.innerHTML = '';
    
    if (results.length === 0) {
        container.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 1.5rem;">No results found</td></tr>';
        return;
    }
    
    const uniqueIds = new Set();
    
    results.slice(0, 50).forEach(paste => {
        // Skip duplicates
        if (uniqueIds.has(paste.id)) return;
        uniqueIds.add(paste.id);
        
        const row = document.createElement('tr');
        
        // Title cell with clickable link
        const titleCell = document.createElement('td');
        const titleLink = document.createElement('a');
        titleLink.href = 'javascript:void(0)';
        titleLink.className = 'paste-title-link';
        titleLink.textContent = paste.title;
        titleLink.onclick = () => showPasteDetail(paste.id);
        titleCell.appendChild(titleLink);
        
        if (paste.isPinned) {
            const pinnedBadge = document.createElement('span');
            pinnedBadge.className = 'badge badge-pinned';
            pinnedBadge.textContent = 'PINNED';
            titleCell.appendChild(pinnedBadge);
        }
        
        // Comments cell
        const commentsCell = document.createElement('td');
        const commentsSpan = document.createElement('span');
        commentsSpan.className = 'comments-count';
        commentsSpan.textContent = paste.commentCount || '0';
        commentsSpan.onclick = () => showPasteDetail(paste.id);
        commentsSpan.style.cursor = 'pointer';
        commentsCell.appendChild(commentsSpan);
        
        // Views cell
        const viewsCell = document.createElement('td');
        const viewsSpan = document.createElement('span');
        viewsSpan.className = 'views-count';
        viewsSpan.textContent = paste.views || 0;
        viewsSpan.onclick = () => showPasteDetail(paste.id);
        viewsSpan.style.cursor = 'pointer';
        viewsCell.appendChild(viewsSpan);
        
        // Created by cell
        const userCell = document.createElement('td');
        const userLink = document.createElement('a');
        userLink.href = 'javascript:void(0)';
        userLink.className = 'paste-link';
        userLink.textContent = paste.username || 'Anonymous';
        userLink.onclick = () => showUserProfile(paste.userId);
        userCell.appendChild(userLink);
        
        // Added date cell
        const dateCell = document.createElement('td');
        dateCell.textContent = formatTime(paste.timestamp?.toDate());
        
        // Append all cells to row
        row.appendChild(titleCell);
        row.appendChild(commentsCell);
        row.appendChild(viewsCell);
        row.appendChild(userCell);
        row.appendChild(dateCell);
        
        container.appendChild(row);
    });
}

// Chat Functions
function loadChatMessages() {
    chatDb.collection('messages')
        .orderBy('timestamp', 'desc')
        .limit(100)
        .onSnapshot(snapshot => {
            const container = document.getElementById('chat-messages');
            container.innerHTML = '';
            
            const messages = [];
            snapshot.forEach(doc => {
                messages.push({ id: doc.id, ...doc.data() });
            });
            
            // Sort by timestamp (newest first)
            messages.sort((a, b) => b.timestamp - a.timestamp);
            
            if (messages.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1.5rem; color: #888;">No messages yet</div>';
                return;
            }
            
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-sender">${escapeHtml(msg.username || 'Unknown User')}:</div>
                        <div class="message-time">${formatTime(msg.timestamp?.toDate())}</div>
                    </div>
                    <div>${escapeHtml(msg.message)}</div>
                `;
                
                container.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }, error => {
            console.error('Error loading chat:', error);
        });
}

async function sendChatMessage() {
    if (!currentUser) {
        showAlert('Please sign in to chat', 'error');
        showPage('auth');
        return;
    }
    
    const input = document.getElementById('chat-input');
    const message = input.value.trim();
    
    if (!message) return;
    
    try {
        await chatDb.collection('messages').add({
            message: message,
            username: userData.displayName || userData.username || currentUser.email.split('@')[0],
            userId: currentUser.uid,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        input.value = '';
    } catch (error) {
        showAlert(`Error sending message: ${error.message}`, 'error');
    }
}

// Most Mentioned
async function loadMostMentioned() {
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('isRemoved', '==', false)
            .get();
        
        const titleCount = {};
        snapshot.forEach(doc => {
            const paste = doc.data();
            const title = paste.title.toLowerCase().trim();
            if (title) {
                titleCount[title] = (titleCount[title] || 0) + 1;
            }
        });
        
        const sortedTitles = Object.entries(titleCount)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 20);
        
        const container = document.getElementById('most-mentioned-container');
        container.innerHTML = '';
        
        sortedTitles.forEach(([title, count], index) => {
            const card = document.createElement('div');
            card.className = 'paste-card';
            card.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 0.8rem;">#${index + 1}</div>
                <div class="paste-title">${escapeHtml(title)}</div>
                <div class="paste-views">Mentioned ${count} times</div>
            `;
            container.appendChild(card);
        });
    } catch (error) {
        console.error('Error loading most mentioned:', error);
    }
}

// Profile Functions
async function loadUserProfileData() {
    if (!currentUser) return;
    
    try {
        const doc = await pasteDb.collection('users').doc(currentUser.uid).get();
        if (doc.exists) {
            const userData = doc.data();
            
            document.getElementById('display-name').value = userData.displayName || '';
            document.getElementById('banner-url').value = userData.bannerUrl || '';
            document.getElementById('profile-url').value = userData.profileUrl || '';
            
            if (userData.bannerUrl) {
                document.getElementById('profile-banner-img').style.backgroundImage = `url('${userData.bannerUrl}')`;
            }
            
            if (userData.profileUrl) {
                document.getElementById('profile-picture-img').style.backgroundImage = `url('${userData.profileUrl}')`;
            }
        }
    } catch (error) {
        console.error('Error loading profile data:', error);
    }
}

async function updateDisplayName() {
    if (!currentUser) return;
    
    const displayName = document.getElementById('display-name').value.trim();
    if (!displayName) {
        showAlert('Please enter a display name', 'error');
        return;
    }
    
    try {
        await pasteDb.collection('users').doc(currentUser.uid).update({
            displayName: displayName,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        userData.displayName = displayName;
        showAlert('Display name updated successfully!', 'success');
        updateUIForAuth();
    } catch (error) {
        showAlert(`Error updating display name: ${error.message}`, 'error');
    }
}

async function updateBanner() {
    if (!currentUser) return;
    
    const bannerUrl = document.getElementById('banner-url').value.trim();
    if (!bannerUrl) {
        showAlert('Please enter a banner URL', 'error');
        return;
    }
    
    try {
        await pasteDb.collection('users').doc(currentUser.uid).update({
            bannerUrl: bannerUrl,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        userData.bannerUrl = bannerUrl;
        showAlert('Banner updated successfully!', 'success');
        document.getElementById('profile-banner-img').style.backgroundImage = `url('${bannerUrl}')`;
    } catch (error) {
        showAlert(`Error updating banner: ${error.message}`, 'error');
    }
}

async function updateProfilePicture() {
    if (!currentUser) return;
    
    const profileUrl = document.getElementById('profile-url').value.trim();
    if (!profileUrl) {
        showAlert('Please enter a profile picture URL', 'error');
        return;
    }
    
    try {
        await pasteDb.collection('users').doc(currentUser.uid).update({
            profileUrl: profileUrl,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        userData.profileUrl = profileUrl;
        showAlert('Profile picture updated successfully!', 'success');
        document.getElementById('profile-picture-img').style.backgroundImage = `url('${profileUrl}')`;
    } catch (error) {
        showAlert(`Error updating profile picture: ${error.message}`, 'error');
    }
}

// NEW: Enhanced User Profile Function
async function showUserProfile(userId) {
    // Show user profile page
    showPage('userProfile');
    
    try {
        const userDoc = await pasteDb.collection('users').doc(userId).get();
        
        if (!userDoc.exists) {
            document.getElementById('user-profile-page').innerHTML = `
                <button class="back-btn" onclick="showPage('home')">← Back to Pastes</button>
                <div style="text-align: center; padding: 3rem;">
                    <h2>User not found</h2>
                    <p>The user you're looking for doesn't exist.</p>
                </div>
            `;
            return;
        }
        
        const userData = userDoc.data();
        
        // Set banner
        const banner = document.getElementById('profile-banner');
        if (userData.bannerUrl) {
            banner.style.backgroundImage = `url('${userData.bannerUrl}')`;
        } else {
            banner.style.backgroundImage = '';
            banner.style.backgroundColor = 'var(--bg-color)';
        }
        
        // Set avatar
        const avatar = document.getElementById('profile-avatar');
        if (userData.profileUrl) {
            avatar.style.backgroundImage = `url('${userData.profileUrl}')`;
        } else {
            avatar.style.backgroundImage = '';
            avatar.style.backgroundColor = 'var(--bg-color)';
        }
        
        // Set username with color
        const username = document.getElementById('profile-username');
        username.textContent = userData.displayName || userData.username || 'Anonymous';
        username.style.color = userData.usernameColor || '#ffffff';
        
        // Add glow effects based on role
        if (userData.isOwner) {
            username.className = 'profile-username owner-glow';
        } else if (userData.isVIP) {
            username.className = 'profile-username vip-glow';
        } else {
            username.className = 'profile-username';
        }
        
        // Set badges
        const badges = document.getElementById('profile-badges');
        badges.innerHTML = '';
        
        if (userData.isBanned) {
            badges.innerHTML += '<span class="badge badge-admin">BANNED</span>';
        }
        if (userData.isOwner) {
            badges.innerHTML += '<span class="badge badge-owner">Owner</span>';
        }
        if (userData.isAdmin) {
            badges.innerHTML += '<span class="badge badge-admin">Admin</span>';
        }
        if (userData.isManager) {
            badges.innerHTML += '<span class="badge badge-manager">Manager</span>';
        }
        if (userData.isVIP) {
            badges.innerHTML += '<span class="badge badge-vip">VIP</span>';
        }
        if (userData.isTagMaker) {
            badges.innerHTML += '<span class="badge badge-tagmaker">Tag Maker</span>';
        }
        
        // Set stats
        document.getElementById('paste-count').textContent = userData.pasteCount || 0;
        document.getElementById('follows-count').textContent = userData.followers ? userData.followers.length : 0;
        document.getElementById('following-count').textContent = userData.following ? userData.following.length : 0;
        
        // Load user's pastes
        await loadUserPastes(userId);
        
    } catch (error) {
        console.error('Error loading user profile:', error);
        showAlert('Error loading profile', 'error');
    }
}

async function loadUserPastes(userId) {
    try {
        const snapshot = await pasteDb.collection('pastes')
            .where('userId', '==', userId)
            .where('isRemoved', '==', false)
            .orderBy('timestamp', 'desc')
            .limit(20)
            .get();
        
        const container = document.getElementById('user-pastes-container');
        container.innerHTML = '';
        
        if (snapshot.empty) {
            container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #888;">No pastes yet</div>';
            return;
        }
        
        snapshot.forEach(doc => {
            const paste = doc.data();
            const pasteCard = document.createElement('div');
            pasteCard.className = 'user-paste-card';
            pasteCard.onclick = () => showPasteDetail(doc.id);
            
            pasteCard.innerHTML = `
                <div class="user-paste-title">${escapeHtml(paste.title)}</div>
                <div style="color: #888; font-size: 0.9rem; margin: 0.5rem 0; max-height: 60px; overflow: hidden;">
                    ${escapeHtml(paste.content.substring(0, 100))}${paste.content.length > 100 ? '...' : ''}
                </div>
                <div class="user-paste-meta">
                    <span>${paste.views || 0} views</span>
                    <span>${formatTime(paste.timestamp?.toDate())}</span>
                </div>
            `;
            
            container.appendChild(pasteCard);
        });
        
    } catch (error) {
        console.error('Error loading user pastes:', error);
        const container = document.getElementById('user-pastes-container');
        container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #ff0000;">Error loading pastes</div>';
    }
}

// VIP Functions
async function loadVIPFeatures() {
    if (!currentUser || (!isVIP && !isOwner)) {
        showAlert('VIP access required', 'error');
        showPage('home');
        return;
    }
    
    document.getElementById('username-color').value = userData.usernameColor || '#ffffff';
}

async function updateUsernameColor() {
    if (!currentUser || (!isVIP && !isOwner)) return;
    
    const color = document.getElementById('username-color').value;
    
    try {
        await pasteDb.collection('users').doc(currentUser.uid).update({
            usernameColor: color,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        userData.usernameColor = color;
        showAlert('Username color updated successfully!', 'success');
        updateUIForAuth();
    } catch (error) {
        showAlert(`Error updating username color: ${error.message}`, 'error');
    }
}

// Tag Functions
async function loadTags() {
    if (!currentUser || (!isTagMaker && !isOwner && !isManager && !isAdmin)) {
        showAlert('Tag Maker access required', 'error');
        showPage('home');
        return;
    }
    
    const container = document.getElementById('tags-container');
    container.innerHTML = '';
    
    try {
        const snapshot = await pasteDb.collection('tags').orderBy('createdAt', 'desc').get();
        
        if (snapshot.empty) {
            container.innerHTML = '<div style="text-align: center; padding: 1.5rem; color: #888;">No tags created yet</div>';
            return;
        }
        
        snapshot.forEach(doc => {
            const tag = doc.data();
            const tagElement = document.createElement('div');
            tagElement.className = 'tag-item';
            tagElement.innerHTML = `
                <div>
                    <span class="tag-name" style="background-color: ${tag.color}; color: ${getContrastColor(tag.color)}">
                        ${escapeHtml(tag.name)}
                    </span>
                    <div style="color: #888; font-size: 0.8rem; margin-top: 0.4rem;">
                        Created by: ${escapeHtml(tag.createdBy || 'Unknown')}
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-danger btn-small" onclick="deleteTag('${doc.id}')">Delete</button>
                </div>
            `;
            container.appendChild(tagElement);
        });
    } catch (error) {
        console.error('Error loading tags:', error);
    }
}

function getContrastColor(hexcolor) {
    // Remove the # if present
    hexcolor = hexcolor.replace("#", "");
    
    // Convert to RGB
    const r = parseInt(hexcolor.substr(0, 2), 16);
    const g = parseInt(hexcolor.substr(2, 2), 16);
    const b = parseInt(hexcolor.substr(4, 2), 16);
    
    // Calculate luminance
    const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
    
    // Return black or white depending on luminance
    return luminance > 0.5 ? '#000000' : '#ffffff';
}

async function createTag() {
    if (!currentUser || (!isTagMaker && !isOwner && !isManager && !isAdmin)) return;
    
    const name = document.getElementById('tag-name').value.trim();
    const color = document.getElementById('tag-color').value;
    
    if (!name) {
        showAlert('Please enter a tag name', 'error');
        return;
    }
    
    try {
        await pasteDb.collection('tags').add({
            name: name,
            color: color,
            createdBy: userData.displayName || userData.username || currentUser.email.split('@')[0],
            createdById: currentUser.uid,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showAlert('Tag created successfully!', 'success');
        document.getElementById('tag-name').value = '';
        loadTags();
    } catch (error) {
        showAlert(`Error creating tag: ${error.message}`, 'error');
    }
}

async function deleteTag(tagId) {
    if (!currentUser || (!isTagMaker && !isOwner && !isManager && !isAdmin)) return;
    
    if (confirm('Are you sure you want to delete this tag?')) {
        try {
            await pasteDb.collection('tags').doc(tagId).delete();
            showAlert('Tag deleted successfully!', 'success');
            loadTags();
        } catch (error) {
            showAlert(`Error deleting tag: ${error.message}`, 'error');
        }
    }
}

// Timeout Functions
function showTimeoutNotification(timeoutUntil) {
    const overlay = document.getElementById('timeout-overlay');
    const details = document.getElementById('timeout-details');
    
    const now = new Date();
    const diff = timeoutUntil - now;
    
    if (diff <= 0) {
        overlay.classList.remove('active');
        if (timeoutInterval) {
            clearInterval(timeoutInterval);
        }
        return;
    }
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    let timeString = '';
    if (days > 0) timeString += `${days}d `;
    if (hours > 0) timeString += `${hours}h `;
    if (minutes > 0) timeString += `${minutes}m `;
    timeString += `${seconds}s`;
    
    details.textContent = `Time remaining: ${timeString}`;
    overlay.classList.add('active');
    
    // Update countdown every second
    if (timeoutInterval) {
        clearInterval(timeoutInterval);
    }
    
    timeoutInterval = setInterval(() => {
        const now = new Date();
        const diff = timeoutUntil - now;
        
        if (diff <= 0) {
            overlay.classList.remove('active');
            clearInterval(timeoutInterval);
            location.reload();
            return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        let timeString = '';
        if (days > 0) timeString += `${days}d `;
        if (hours > 0) timeString += `${hours}h `;
        if (minutes > 0) timeString += `${minutes}m `;
        timeString += `${seconds}s`;
        
        details.textContent = `Time remaining: ${timeString}`;
    }, 1000);
}

function showTimeoutForm() {
    document.getElementById('timeout-form').classList.remove('hidden');
}

function hideTimeoutForm() {
    document.getElementById('timeout-form').classList.add('hidden');
    document.getElementById('timeout-email').value = '';
    document.getElementById('timeout-days').value = '';
    document.getElementById('timeout-hours').value = '';
    document.getElementById('timeout-minutes').value = '';
    document.getElementById('timeout-seconds').value = '';
}

function showTimeoutUserForm(userId) {
    showPage('admin');
    showTimeoutForm();
    document.getElementById('timeout-email').value = userId;
}

async function adminTimeoutUser() {
    if (!isAdmin && !isManager && !isOwner) return;
    
    const emailOrId = document.getElementById('timeout-email').value.trim();
    const days = parseInt(document.getElementById('timeout-days').value) || 0;
    const hours = parseInt(document.getElementById('timeout-hours').value) || 0;
    const minutes = parseInt(document.getElementById('timeout-minutes').value) || 0;
    const seconds = parseInt(document.getElementById('timeout-seconds').value) || 0;
    
    if (!emailOrId) {
        showAlert('Please enter user email or ID', 'error');
        return;
    }
    
    if (days === 0 && hours === 0 && minutes === 0 && seconds === 0) {
        showAlert('Please enter a timeout duration', 'error');
        return;
    }
    
    try {
        // Find user by email or ID
        let userId = emailOrId;
        
        // Check if it's an email
        if (emailOrId.includes('@')) {
            // Find user by email
            const usersSnapshot = await pasteDb.collection('users').where('email', '==', emailOrId).get();
            if (usersSnapshot.empty) {
                showAlert('User not found', 'error');
                return;
            }
            userId = usersSnapshot.docs[0].id;
        }
        
        // Calculate timeout duration
        const totalSeconds = (days * 24 * 60 * 60) + (hours * 60 * 60) + (minutes * 60) + seconds;
        const timeoutUntil = new Date(Date.now() + (totalSeconds * 1000));
        
        await pasteDb.collection('users').doc(userId).update({
            timeoutUntil: firebase.firestore.Timestamp.fromDate(timeoutUntil)
        });
        
        showAlert(`User timed out for ${days}d ${hours}h ${minutes}m ${seconds}s`, 'success');
        hideTimeoutForm();
        
        // If timing out current user, show notification
        if (userId === currentUser?.uid) {
            showTimeoutNotification(timeoutUntil);
        }
    } catch (error) {
        showAlert(`Error timing out user: ${error.message}`, 'error');
    }
}

async function adminUntimeoutUser(userId) {
    if (!isAdmin && !isManager && !isOwner) return;
    
    if (confirm('Are you sure you want to remove timeout from this user?')) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                timeoutUntil: null
            });
            
            showAlert('Timeout removed successfully', 'success');
            
            // If un-timing out current user, hide notification
            if (userId === currentUser?.uid) {
                document.getElementById('timeout-overlay').classList.remove('active');
                if (timeoutInterval) {
                    clearInterval(timeoutInterval);
                }
            }
        } catch (error) {
            showAlert(`Error removing timeout: ${error.message}`, 'error');
        }
    }
}

// Admin Functions
async function loadAdminStats() {
    if (!isAdmin && !isManager && !isOwner) {
        showAlert('Admin/Manager access required', 'error');
        showPage('home');
        return;
    }
    
    try {
        // Get stats
        const usersSnap = await pasteDb.collection('users').get();
        const pastesSnap = await pasteDb.collection('pastes').where('isRemoved', '==', false).get();
        const chatSnap = await chatDb.collection('messages').get();
        
        const totalUsers = usersSnap.size;
        const totalPastes = pastesSnap.size;
        const bannedUsers = usersSnap.docs.filter(doc => doc.data().isBanned).length;
        const pinnedPastes = pastesSnap.docs.filter(doc => doc.data().isPinned).length;
        
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('totalPastes').textContent = totalPastes;
        document.getElementById('bannedUsers').textContent = bannedUsers;
        document.getElementById('pinnedPastes').textContent = pinnedPastes;
        
    } catch (error) {
        console.error('Error loading admin stats:', error);
    }
}

async function adminPinPaste(pasteId, pinState) {
    if (!isAdmin && !isManager && !isOwner) return;
    
    try {
        await pasteDb.collection('pastes').doc(pasteId).update({
            isPinned: pinState
        });
        showAlert(`Paste ${pinState ? 'pinned to pinned section' : 'removed from pinned section'}`, 'success');
        
        // Reload both pinned and all pastes
        loadPaginationData();
        loadPinnedPastes();
        
        // If in paste detail view, update the content
        if (document.getElementById('paste-detail-container').classList.contains('active')) {
            loadPasteDetailContent(pasteId);
        }
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminRemovePaste(pasteId) {
    if (!isAdmin && !isManager && !isOwner) return;
    
    if (confirm('Are you sure you want to remove this paste?')) {
        try {
            await pasteDb.collection('pastes').doc(pasteId).update({
                isRemoved: true
            });
            showAlert('Paste removed', 'success');
            closePasteDetail();
            loadPaginationData();
            loadPinnedPastes();
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminBanUser(userId, banState = true) {
    if (!isAdmin && !isManager && !isOwner) return;
    
    const action = banState ? 'ban' : 'unban';
    if (confirm(`Are you sure you want to ${action} this user?`)) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                isBanned: banState
            });
            showAlert(`User ${banState ? 'banned' : 'unbanned'}`, 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminDeleteUserPosts(userId) {
    if (!isAdmin && !isManager && !isOwner) return;
    
    if (confirm('Delete ALL posts by this user?')) {
        try {
            const snapshot = await pasteDb.collection('pastes')
                .where('userId', '==', userId)
                .get();
            
            const batch = pasteDb.batch();
            snapshot.forEach(doc => {
                batch.update(doc.ref, { isRemoved: true });
            });
            
            await batch.commit();
            showAlert('All user posts removed', 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminMakeAdmin(userId, makeAdmin) {
    if (!isAdmin && !isOwner) return;
    
    if (confirm(`${makeAdmin ? 'Make' : 'Remove'} admin privileges?`)) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                isAdmin: makeAdmin
            });
            showAlert(`Admin privileges ${makeAdmin ? 'granted' : 'removed'}`, 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminMakeManager(userId, makeManager) {
    if (!isAdmin && !isOwner) return;
    
    if (confirm(`${makeManager ? 'Make' : 'Remove'} manager privileges?`)) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                isManager: makeManager
            });
            showAlert(`Manager privileges ${makeManager ? 'granted' : 'removed'}`, 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminMakeVIP(userId, makeVIP) {
    if (!isAdmin && !isOwner && !isManager) return;
    
    if (confirm(`${makeVIP ? 'Make' : 'Remove'} VIP privileges?`)) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                isVIP: makeVIP
            });
            showAlert(`VIP privileges ${makeVIP ? 'granted' : 'removed'}`, 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminMakeTagMaker(userId, makeTagMaker) {
    if (!isAdmin && !isOwner && !isManager) return;
    
    if (confirm(`${makeTagMaker ? 'Make' : 'Remove'} Tag Maker privileges?`)) {
        try {
            await pasteDb.collection('users').doc(userId).update({
                isTagMaker: makeTagMaker
            });
            showAlert(`Tag Maker privileges ${makeTagMaker ? 'granted' : 'removed'}`, 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminClearChat() {
    if (!isAdmin && !isManager && !isOwner) return;
    
    if (confirm('Clear ALL chat messages?')) {
        try {
            const snapshot = await chatDb.collection('messages').get();
            const batch = chatDb.batch();
            snapshot.forEach(doc => {
                batch.delete(doc.ref);
            });
            
            await batch.commit();
            showAlert('Chat cleared', 'success');
        } catch (error) {
            showAlert(`Error: ${error.message}`, 'error');
        }
    }
}

async function adminViewAllUsers() {
    if (!isAdmin && !isManager && !isOwner) return;
    
    try {
        const snapshot = await pasteDb.collection('users').orderBy('createdAt', 'desc').get();
        const container = document.getElementById('admin-content');
        
        let html = '<h3 style="font-size: 1.2rem; margin-bottom: 1rem;">All Users:</h3><div class="pastes-grid">';
        
        snapshot.forEach(doc => {
            const user = doc.data();
            html += `
                <div class="paste-card">
                    <div class="paste-username" onclick="showUserProfile('${doc.id}')">
                        ${escapeHtml(user.displayName || user.username || user.email?.split('@')[0] || 'Unknown User')}
                        ${user.isBanned ? '<span class="badge badge-admin">BANNED</span>' : ''}
                        ${user.isAdmin ? '<span class="badge badge-admin">ADMIN</span>' : ''}
                        ${user.isManager ? '<span class="badge badge-manager">MANAGER</span>' : ''}
                        ${user.isVIP ? '<span class="badge badge-vip">VIP</span>' : ''}
                        ${user.isTagMaker ? '<span class="badge badge-tagmaker">TAG MAKER</span>' : ''}
                        ${user.isOwner ? '<span class="badge badge-owner">OWNER</span>' : ''}
                    </div>
                    <div class="paste-title">${escapeHtml(user.email || 'No email')}</div>
                    <div class="paste-views">
                        Joined: ${formatTime(user.createdAt?.toDate())}
                        ${user.timeoutUntil ? `<br>Timeout until: ${formatTime(user.timeoutUntil?.toDate())}` : ''}
                    </div>
                    <div class="btn-group mt-2">
                        ${(isAdmin || isManager || isOwner) ? `<button class="btn btn-danger btn-small" onclick="adminBanUser('${doc.id}', ${!user.isBanned})">
                            ${user.isBanned ? 'Unban' : 'Ban'}
                        </button>` : ''}
                        ${isAdmin ? `<button class="btn btn-danger btn-small" onclick="adminMakeAdmin('${doc.id}', ${!user.isAdmin})">
                            ${user.isAdmin ? 'Remove Admin' : 'Make Admin'}
                        </button>` : ''}
                        ${(isAdmin || isOwner) ? `<button class="btn btn-danger btn-small" onclick="adminMakeManager('${doc.id}', ${!user.isManager})">
                            ${user.isManager ? 'Remove Manager' : 'Make Manager'}
                        </button>` : ''}
                        ${(isAdmin || isOwner || isManager) ? `<button class="btn btn-danger btn-small" onclick="adminMakeVIP('${doc.id}', ${!user.isVIP})">
                            ${user.isVIP ? 'Remove VIP' : 'Make VIP'}
                        </button>` : ''}
                        ${(isAdmin || isOwner || isManager) ? `<button class="btn btn-danger btn-small" onclick="adminMakeTagMaker('${doc.id}', ${!user.isTagMaker})">
                            ${user.isTagMaker ? 'Remove Tag Maker' : 'Make Tag Maker'}
                        </button>` : ''}
                        ${(isAdmin || isManager || isOwner) ? `<button class="btn btn-danger btn-small" onclick="showTimeoutUserForm('${doc.id}')">
                            Timeout
                        </button>` : ''}
                        ${(isAdmin || isManager || isOwner) && user.timeoutUntil ? `<button class="btn btn-success btn-small" onclick="adminUntimeoutUser('${doc.id}')">
                            Un-timeout
                        </button>` : ''}
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminViewAllPastes() {
    if (!isAdmin && !isManager && !isOwner) return;
    
    try {
        const snapshot = await pasteDb.collection('pastes')
            .orderBy('timestamp', 'desc')
            .limit(100)
            .get();
        
        const container = document.getElementById('admin-content');
        container.innerHTML = '<h3 style="font-size: 1.2rem; margin-bottom: 1rem;">All Pastes:</h3><div class="pastes-grid">';
        
        snapshot.forEach(doc => {
            const paste = doc.data();
            container.innerHTML += `
                <div class="paste-card">
                    <div class="paste-username" onclick="showUserProfile('${paste.userId}')">
                        ${escapeHtml(paste.username || 'Unknown User')}
                        ${paste.isPinned ? '<span class="badge badge-pinned">PINNED</span>' : ''}
                        ${paste.isRemoved ? '<span class="badge badge-admin">REMOVED</span>' : ''}
                    </div>
                    <div class="paste-title">${escapeHtml(paste.title)}</div>
                    <div class="paste-views">${paste.views || 0} views • ${formatTime(paste.timestamp?.toDate())}</div>
                    <div class="btn-group mt-2">
                        ${(isAdmin || isManager || isOwner) ? `<button class="btn btn-success btn-small" onclick="adminPinPaste('${doc.id}', true)">
                            Pin to Pinned
                        </button>` : ''}
                        ${(isAdmin || isManager || isOwner) ? `<button class="btn btn-danger btn-small" onclick="adminRemovePaste('${doc.id}')">
                            Remove
                        </button>` : ''}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML += '</div>';
    } catch (error) {
        showAlert(`Error: ${error.message}`, 'error');
    }
}

async function adminManageRoles() {
    if (!isAdmin && !isOwner) return;
    
    adminViewAllUsers();
}

function adminBackupData() {
    if (!isAdmin && !isManager && !isOwner) return;
    
    showAlert('Backup feature would export data here', 'success');
}

// Utility Functions
function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function formatTime(date) {
    if (!date) return 'Unknown';
    
    const now = new Date();
    const diff = now - date;
    
    if (diff < 60000) return 'Just now';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
    
    // Return date in format like "Dec 24, 2025"
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const month = months[date.getMonth()];
    const day = date.getDate();
    const year = date.getFullYear();
    
    return `${month} ${day}, ${year}`;
}

// Initialize App
document.addEventListener('DOMContentLoaded', () => {
    // Set logo
    const logo = document.querySelector('.logo');
    if (logo) {
        logo.src = "https://i.postimg.cc/x8ML5hVd/logo.jpg";
        logo.onerror = function() {
            this.src = 'https://via.placeholder.com/300x100/000000/ffffff?text=NORBIN+LOGO';
        };
    }
    
    // Set up auth listener
    pasteAuth.onAuthStateChanged(async (user) => {
        currentUser = user;
        if (user) {
            await checkUserStatus();
        } else {
            resetUserStatus();
        }
        updateUIForAuth();
        loadPaginationData();
        loadPinnedPastes();
    });
    
    // Show home page
    showPage('home');
    
    // Close menu when clicking outside
    document.addEventListener('click', (event) => {
        const menu = document.getElementById('slideDownMenu');
        const hamburger = document.querySelector('.hamburger-btn');
        
        if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
            menu.classList.remove('active');
        }
    });
    
    // Enable music autoplay on user interaction
    document.body.addEventListener('click', function() {
        const hallMusic = document.getElementById('hallMusic');
        if (hallMusic && hallMusic.paused) {
            hallMusic.play().catch(e => console.log("Music play prevented"));
        }
    });
    
    // Check for paste ID in URL
    const urlParams = new URLSearchParams(window.location.search);
    const pasteId = urlParams.get('paste');
    if (pasteId) {
        showPasteDetail(pasteId);
    }
});
</script>
</body>
</html>
